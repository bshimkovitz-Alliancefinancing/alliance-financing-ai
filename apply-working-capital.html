<!DOCTYPE html>
<html lang="en">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FHD2GL25L"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date());gtag('config','G-FHD2GL25L');</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Working Capital &amp; Factoring Application - Alliance Financing AI</title>
    <meta name="description" content="Apply for working capital financing, factoring, accounts receivable financing, term loans and more. AI-powered matching with 70+ lenders.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
nav{position:fixed;top:0;width:100%;background:rgba(255,255,255,.95);backdrop-filter:blur(12px);border-bottom:1px solid #e2e8f0;z-index:1000;padding:1.25rem 0}
.nav-container{max-width:1200px;margin:0 auto;padding:0 2rem;display:grid;grid-template-columns:auto 1fr auto;align-items:center}
.logo{display:flex;align-items:center;text-decoration:none}
.nav-links{display:flex;gap:1.75rem;align-items:center;justify-content:center}
.nav-links a{color:#0F172A;text-decoration:none;font-size:.9375rem;font-weight:600;transition:all .2s;position:relative}
.nav-links a:hover{color:#2563EB}
.nav-links a::after{content:'';position:absolute;bottom:-4px;left:0;width:0;height:2px;background:#2563EB;transition:width .2s}
.nav-links a:hover::after{width:100%}
.nav-cta{justify-self:end;display:flex;gap:1rem}
.btn-outline{background:#fff;color:#334155;border:2px solid #e2e8f0;padding:.75rem 1.5rem;border-radius:.5rem;font-weight:600;cursor:pointer;text-decoration:none;font-size:.9375rem;transition:all .2s}
.btn-outline:hover{border-color:#2563EB;color:#2563EB}
.btn-primary{background:#2563EB;color:#fff;padding:.75rem 1.5rem;border-radius:.5rem;border:none;font-weight:600;cursor:pointer;text-decoration:none;font-size:.9375rem;transition:all .2s}
.btn-primary:hover{background:#1E40AF}
.mobile-menu-btn{display:none;background:#2563EB;border:none;cursor:pointer;padding:.75rem 1.5rem;border-radius:.5rem;color:#fff;font-weight:600;font-size:.9375rem}
@media(max-width:768px){.nav-links,.nav-cta{display:none!important}.mobile-menu-btn{display:block!important}.nav-container{grid-template-columns:auto auto!important}}

*{margin:0;padding:0;box-sizing:border-box}
:root{--primary:#2563EB;--primary-dark:#1E40AF;--slate-50:#F8FAFC;--slate-100:#F1F5F9;--slate-200:#E2E8F0;--slate-600:#475569;--slate-800:#1E293B;--slate-900:#0F172A;--white:#fff;--font:'DM Sans',-apple-system,sans-serif}
body{font-family:var(--font);background:var(--slate-50);color:var(--slate-800);line-height:1.6}
.hero{padding:7rem 2rem 3rem;background:linear-gradient(135deg,#EEF2FF,#F5F3FF);text-align:center}
.hero h1{font-size:clamp(2rem,4vw,2.75rem);font-weight:700;color:var(--slate-900);margin-bottom:.75rem}
.hero p{font-size:1.125rem;color:var(--slate-600);max-width:650px;margin:0 auto}
.form-container{max-width:800px;margin:-2rem auto 4rem;padding:0 1.5rem}
.form-card{background:var(--white);border-radius:1rem;padding:2.5rem;box-shadow:0 4px 20px rgba(0,0,0,.06);border:1px solid var(--slate-200)}
.section-title{font-size:1.25rem;font-weight:700;color:var(--slate-900);margin:2rem 0 1rem;padding-bottom:.5rem;border-bottom:2px solid var(--primary)}
.section-title:first-child{margin-top:0}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:1rem}
.form-row.three{grid-template-columns:1fr 1fr 1fr}
.form-row.four{grid-template-columns:1fr 1fr 1fr 1fr}
.form-group{display:flex;flex-direction:column}
.form-group.full{grid-column:1/-1}
.form-group label{font-size:.8125rem;font-weight:600;color:var(--slate-600);margin-bottom:.25rem}
.form-group input,.form-group select,.form-group textarea{padding:.625rem .75rem;border:1.5px solid var(--slate-200);border-radius:.5rem;font-size:.9375rem;font-family:var(--font);transition:border .2s;outline:none;width:100%;box-sizing:border-box}
.form-group input:focus,.form-group select:focus,.form-group textarea:focus{border-color:var(--primary);box-shadow:0 0 0 3px rgba(37,99,235,.1)}
.form-group textarea{resize:vertical;min-height:80px}
.checkbox-row{display:flex;gap:1.5rem;align-items:center;margin-bottom:1rem;flex-wrap:wrap}
.checkbox-row label{display:flex;align-items:center;gap:.375rem;font-size:.9375rem;cursor:pointer;font-weight:500}
.checkbox-row input[type="checkbox"],.checkbox-row input[type="radio"]{width:18px;height:18px;accent-color:var(--primary)}
.principal-block{background:var(--slate-50);border:1px solid var(--slate-200);border-radius:.75rem;padding:1.5rem;margin-bottom:1rem}
.ref-block{background:var(--slate-50);border:1px solid var(--slate-200);border-radius:.75rem;padding:1.5rem;margin-bottom:1rem}
.submit-btn{width:100%;padding:1rem;background:var(--primary);color:#fff;border:none;border-radius:.75rem;font-size:1.0625rem;font-weight:600;cursor:pointer;transition:background .2s;margin-top:1.5rem}
.submit-btn:hover{background:var(--primary-dark)}
.submit-btn:disabled{background:#94A3B8;cursor:not-allowed}
.consent-text{font-size:.75rem;color:var(--slate-600);line-height:1.6;margin-top:1.5rem;padding:1rem;background:var(--slate-50);border-radius:.5rem;border:1px solid var(--slate-200)}
.success-message{display:none;text-align:center;padding:3rem 2rem}
.success-message h2{color:#10B981;font-size:1.75rem;margin-bottom:1rem}
.success-message p{color:var(--slate-600);font-size:1.0625rem;margin-bottom:.5rem}
.doc-instructions{background:#ECFDF5;border:1px solid #BBF7D0;border-radius:.75rem;padding:1.5rem;margin-top:1.5rem;text-align:left}
.doc-instructions h3{color:#166534;font-size:1rem;margin-bottom:.75rem}
.doc-instructions ul{list-style:disc;padding-left:1.25rem;color:#166534;font-size:.9375rem}
.doc-instructions ul li{margin-bottom:.25rem}
.ref-banner{background:linear-gradient(135deg,#2563EB,#7C3AED);color:#fff;text-align:center;padding:.5rem 1rem;font-size:.875rem}
.ref-banner strong{font-weight:700}
.trust-badges{display:flex;justify-content:center;gap:2rem;margin-top:1.5rem;flex-wrap:wrap}
.trust-badge{display:flex;align-items:center;gap:.375rem;font-size:.8125rem;color:var(--slate-600);font-weight:500}
.trust-badge svg{width:16px;height:16px;stroke:#10B981;fill:none}
.section-note{font-size:.8125rem;color:var(--slate-600);font-style:italic;margin-bottom:1rem}
@media(max-width:768px){.form-row,.form-row.three,.form-row.four{grid-template-columns:1fr}.form-card{padding:1.5rem}.checkbox-row{flex-direction:column;gap:.75rem;align-items:flex-start}}
footer{background:#0F172A;color:#94A3B8;padding:3rem 0 0}
.footer-container{max-width:1200px;margin:0 auto;padding:0 2rem;display:grid;grid-template-columns:2fr 1fr 1fr 1fr;gap:3rem}
.footer-brand h3{color:#fff;font-size:1.25rem;margin-bottom:.75rem}
.footer-brand p{font-size:.9375rem;line-height:1.7}
.footer-links{display:flex;flex-direction:column;gap:.625rem}
.footer-links h4{color:#fff;font-size:.9375rem;font-weight:600;margin-bottom:.5rem}
.footer-links a{color:#94A3B8;text-decoration:none;font-size:.875rem;transition:color .2s}
.footer-links a:hover{color:#fff}
.footer-bottom{max-width:1200px;margin:2rem auto 0;padding:1.5rem 2rem;border-top:1px solid #1E293B;display:flex;justify-content:space-between;font-size:.875rem}
@media(max-width:768px){.footer-container{grid-template-columns:1fr;gap:2rem}.footer-bottom{flex-direction:column;gap:1rem;text-align:center}}
    </style>
</head>
<body>

<div id="refBanner" class="ref-banner" style="display:none">Referred by: <strong id="refName"></strong></div>

<nav>
    <div class="nav-container">
        <a href="index.html" class="logo"><img src="alliance-logo-transparent.png" alt="Alliance Financing Group" style="height:36px;width:auto"></a>
        <div class="nav-links">
            <a href="index.html">Home</a><a href="how-it-works.html">How It Works</a><a href="products.html">Products</a><a href="partners.html">Partners</a><a href="blog.html">Insights</a><a href="track-application.html">Track Application</a>
        </div>
        <div class="nav-cta"><a href="contact.html" class="btn-outline">Contact Us</a><a href="application.html" class="btn-primary">Apply Now</a></div>
        <button class="mobile-menu-btn" onclick="window.location.href='application.html'">Apply Now</button>
    </div>
</nav>

<section class="hero">
    <h1>Working Capital &amp; Factoring Application</h1>
    <p>Apply for working capital, factoring, accounts receivable financing, term loans, and more. One application connects you with multiple lenders.</p>
    <div class="trust-badges">
        <span class="trust-badge"><svg viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>256-bit SSL Encrypted</span>
        <span class="trust-badge"><svg viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>100% Free to Apply</span>
    </div>
</section>

<div class="form-container">
    <div class="form-card" id="formCard">

        <div class="section-title">Financing Request</div>
        <div class="form-row">
            <div class="form-group">
                <label>Type of Financing Requested *</label>
                <select id="financingType" required>
                    <option value="">Select...</option>
                    <option value="Factoring">Factoring / Accounts Receivable</option>
                    <option value="Working Capital">Working Capital</option>
                    <option value="Term Loan">Term Loan</option>
                    <option value="Operating Line">Operating Line of Credit</option>
                    <option value="Purchase Order Financing">Purchase Order Financing</option>
                    <option value="Inventory Financing">Inventory Financing</option>
                    <option value="SBL Loan">SBL / SBA Loan</option>
                    <option value="Export Financing">Export Financing</option>
                    <option value="Sale-Leaseback">Sale-Leaseback</option>
                    <option value="Other">Other</option>
                </select>
            </div>
            <div class="form-group">
                <label>Amount Requested ($) *</label>
                <input type="text" id="amountRequested" required placeholder="e.g. $100,000">
            </div>
        </div>
        <div class="form-group full" style="margin-bottom:1rem">
            <label>Use of Funds *</label>
            <textarea id="useOfFunds" required placeholder="Describe how the funds will be used"></textarea>
        </div>

        <div class="section-title">Business Information</div>
        <div class="form-row">
            <div class="form-group"><label>Business Full Legal Name *</label><input type="text" id="legalName" required></div>
            <div class="form-group"><label>Trade Name / Operating Name</label><input type="text" id="tradeName"></div>
        </div>
        <div class="form-group full" style="margin-bottom:1rem"><label>Mailing Address *</label><input type="text" id="bizAddress" required></div>
        <div class="form-row four">
            <div class="form-group"><label>City *</label><input type="text" id="bizCity" required></div>
            <div class="form-group"><label>Prov/State *</label><input type="text" id="bizProv" required></div>
            <div class="form-group"><label>Postal/Zip *</label><input type="text" id="bizPostal" required></div>
            <div class="form-group"><label>Country *</label><select id="bizCountry" required><option value="Canada">Canada</option><option value="United States">United States</option></select></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label>Phone *</label><input type="tel" id="bizPhone" required></div>
            <div class="form-group"><label>Fax</label><input type="tel" id="bizFax"></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label>Contact Name / Title *</label><input type="text" id="contactName" required></div>
            <div class="form-group"><label>Email *</label><input type="email" id="bizEmail" required></div>
        </div>
        <div class="form-row four">
            <div class="form-group"><label>Date Incorporated *</label><input type="text" id="dateIncorporated" required placeholder="MM/YYYY"></div>
            <div class="form-group"><label>Yrs Under Present Owner</label><input type="text" id="yrsOwner"></div>
            <div class="form-group"><label>GST or Federal ID Number *</label><input type="text" id="taxId" required placeholder="e.g. 123456789 RT0001"></div>
            <div class="form-group"><label>No. of Employees</label><input type="text" id="numEmployees"></div>
        </div>
        <div class="checkbox-row">
            <label><strong style="margin-right:.5rem">Structure:</strong></label>
            <label><input type="radio" name="structure" value="Corporation" checked> Corporation</label>
            <label><input type="radio" name="structure" value="Partnership"> Partnership</label>
            <label><input type="radio" name="structure" value="Proprietorship"> Proprietorship</label>
            <label><input type="radio" name="structure" value="Other"> Other</label>
        </div>
        <div class="form-row">
            <div class="form-group"><label>Annual Sales ($) *</label><input type="text" id="annualSales" required placeholder="e.g. $500,000"></div>
            <div class="form-group"><label>Number of Active Accounts</label><input type="text" id="activeAccounts"></div>
        </div>

        <div class="section-title">Owner / Guarantor #1 *</div>
        <div class="principal-block">
            <div class="form-row three">
                <div class="form-group"><label>Name *</label><input type="text" id="o1Name" required></div>
                <div class="form-group"><label>Title *</label><input type="text" id="o1Title" required></div>
                <div class="form-group"><label>% Owned *</label><input type="text" id="o1Pct" required></div>
            </div>
            <div class="form-row">
                <div class="form-group"><label>Phone</label><input type="tel" id="o1Phone"></div>
                <div class="form-group"><label>Date of Birth *</label><input type="date" id="o1DOB" required></div>
            </div>
            <div class="form-group full" style="margin-bottom:1rem"><label>Home Address *</label><input type="text" id="o1Address" required placeholder="Full address including city, province/state, postal/zip"></div>
            <div class="checkbox-row">
                <label><input type="radio" name="o1Home" value="Own" checked> Own Home</label>
                <label><input type="radio" name="o1Home" value="Rent"> Rent</label>
            </div>
            <div class="form-group full"><label>SIN (Canada) or SSN (US) ‚Äî <em>Optional</em></label><input type="text" id="o1SinSsn" placeholder="e.g. 123-456-789" maxlength="11"></div>
        </div>

        <div class="section-title">Owner / Guarantor #2 (if applicable)</div>
        <div class="principal-block">
            <div class="form-row three">
                <div class="form-group"><label>Name</label><input type="text" id="o2Name"></div>
                <div class="form-group"><label>Title</label><input type="text" id="o2Title"></div>
                <div class="form-group"><label>% Owned</label><input type="text" id="o2Pct"></div>
            </div>
            <div class="form-row">
                <div class="form-group"><label>Phone</label><input type="tel" id="o2Phone"></div>
                <div class="form-group"><label>Date of Birth</label><input type="date" id="o2DOB"></div>
            </div>
            <div class="form-group full"><label>Home Address</label><input type="text" id="o2Address"></div>
        </div>

        <div class="section-title">Additional Questions</div>
        <div class="form-row">
            <div class="form-group"><label>Any owners involved in bankruptcy?</label><select id="bankruptcy"><option value="No">No</option><option value="Yes">Yes</option></select></div>
            <div class="form-group"><label>Business in arrears for taxes?</label><select id="taxArrears"><option value="No">No</option><option value="Yes">Yes</option></select></div>
        </div>

        <div class="section-title">Bank References</div>
        <div class="ref-block">
            <div class="form-row four">
                <div class="form-group"><label>Bank Name *</label><input type="text" id="bank1Name" required></div>
                <div class="form-group"><label>Officer</label><input type="text" id="bank1Officer"></div>
                <div class="form-group"><label>Account #</label><input type="text" id="bank1Acct"></div>
                <div class="form-group"><label>Phone</label><input type="tel" id="bank1Phone"></div>
            </div>
        </div>
        <div class="form-row three">
            <div class="form-group"><label>Existing Line of Credit?</label><select id="hasLOC"><option value="No">No</option><option value="Yes">Yes</option></select></div>
            <div class="form-group"><label>With Whom?</label><input type="text" id="locWith"></div>
            <div class="form-group"><label>Facility Limit ($)</label><input type="text" id="locLimit"></div>
        </div>

        <div class="section-title">Trade References</div>
        <div class="section-note">Provide 2-3 trade references</div>
        <div class="ref-block">
            <div class="form-row three">
                <div class="form-group"><label>Firm Name</label><input type="text" id="trade1Name"></div>
                <div class="form-group"><label>Contact</label><input type="text" id="trade1Contact"></div>
                <div class="form-group"><label>Phone</label><input type="tel" id="trade1Phone"></div>
            </div>
        </div>
        <div class="ref-block">
            <div class="form-row three">
                <div class="form-group"><label>Firm Name</label><input type="text" id="trade2Name"></div>
                <div class="form-group"><label>Contact</label><input type="text" id="trade2Contact"></div>
                <div class="form-group"><label>Phone</label><input type="tel" id="trade2Phone"></div>
            </div>
        </div>

        <div class="section-title">Accounts Receivable Information</div>
        <div class="section-note">Complete this section if applying for factoring or receivables financing</div>
        <div class="form-row">
            <div class="form-group"><label>Outstanding Receivables ($)</label><input type="text" id="arOutstanding" placeholder="e.g. $200,000"></div>
            <div class="form-group"><label>Terms of Sale</label><input type="text" id="arTerms" placeholder="e.g. Net 30, Net 60"></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label>Average Monthly Sales ($)</label><input type="text" id="arMonthlySales"></div>
            <div class="form-group"><label>Number of Active Accounts</label><input type="text" id="arActiveAccounts"></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label>Amount of Invoices to Sell ($)</label><input type="text" id="arInvoiceSell" placeholder="Initial amount"></div>
            <div class="form-group"><label>Then $ Per Month</label><input type="text" id="arMonthly"></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label>Receivables Pledged as Collateral?</label><select id="arPledged"><option value="No">No</option><option value="Yes">Yes</option></select></div>
            <div class="form-group"><label>If Yes, to Whom?</label><input type="text" id="arPledgedTo"></div>
        </div>

        <div class="section-title">Supporting Documents</div>
        <div style="background:#F0F9FF;border:1px solid #BFDBFE;border-radius:.75rem;padding:1.25rem;margin-bottom:1.25rem">
            <h3 style="color:#1E40AF;font-size:.9375rem;margin-bottom:.75rem;margin-top:0">Last 2 Years Financial Statements (Optional)</h3>
            <p style="color:#1E40AF;font-size:.875rem;margin-bottom:1rem;line-height:1.6">Upload your most recent 2 years of financial statements or tax returns to help speed up your approval, or email them to <strong>info@alliancefinancing.ai</strong> with your Tracking Number after submission.</p>
            <div id="dropZoneFinancials" style="border:2px dashed #3B82F6;border-radius:.75rem;padding:2rem;text-align:center;cursor:pointer;transition:all .2s;background:white" onclick="document.getElementById('financialsInput').click()">
                <svg style="width:32px;height:32px;margin:0 auto .75rem;color:#3B82F6;display:block" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
                <p style="margin:0 0 .5rem;color:#333;font-weight:500">Drag and drop financial statements here, or click to select</p>
                <p style="margin:0;color:#666;font-size:.875rem">PDF, PNG, JPG ‚Äî max 10MB per file</p>
                <input type="file" id="financialsInput" multiple accept=".pdf,.png,.jpg,.jpeg" style="display:none">
            </div>
            <div id="financialsFileList"></div>
        </div>

        <div style="background:#F0F9FF;border:1px solid #BFDBFE;border-radius:.75rem;padding:1.25rem;margin-bottom:1.5rem">
            <h3 style="color:#1E40AF;font-size:.9375rem;margin-bottom:.75rem;margin-top:0">Current & Aged AP / AR Reports (Optional)</h3>
            <p style="color:#1E40AF;font-size:.875rem;margin-bottom:1rem;line-height:1.6">Upload your current accounts payable and accounts receivable aging reports. These are especially important for factoring applications.</p>
            <div id="dropZoneApar" style="border:2px dashed #059669;border-radius:.75rem;padding:2rem;text-align:center;cursor:pointer;transition:all .2s;background:white" onclick="document.getElementById('aparInput').click()">
                <svg style="width:32px;height:32px;margin:0 auto .75rem;color:#059669;display:block" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
                <p style="margin:0 0 .5rem;color:#333;font-weight:500">Drag and drop AP/AR aging reports here, or click to select</p>
                <p style="margin:0;color:#666;font-size:.875rem">PDF, PNG, JPG ‚Äî max 10MB per file</p>
                <input type="file" id="aparInput" multiple accept=".pdf,.png,.jpg,.jpeg" style="display:none">
            </div>
            <div id="aparFileList"></div>
        </div>

        <div id="wcUploadProgress" style="display:none;margin-bottom:1.5rem">
            <div style="width:100%;height:8px;background:#E5E7EB;border-radius:4px;overflow:hidden">
                <div id="wcProgressBar" style="width:0%;height:100%;background:#10B981;transition:width .3s"></div>
            </div>
            <p id="wcProgressText" style="margin-top:.5rem;font-size:.875rem;color:#666"></p>
        </div>

        <div class="section-title">E-Signature & Authorization</div>
        <div class="form-group full" style="margin-bottom:1rem">
            <label>Print Your Full Legal Name (Electronic Signature) *</label>
            <input type="text" id="signatureName" required placeholder="Your full legal name as it appears on official ID" style="font-size:1.1rem;font-weight:600;border:2px solid var(--primary);padding:.75rem">
        </div>
        <div style="background:#EFF6FF;border:1px solid #BFDBFE;border-radius:.75rem;padding:1.25rem;margin-bottom:1rem">
            <p style="color:#1E40AF;font-size:.875rem;line-height:1.6;margin-bottom:.5rem">
                By typing your name above and submitting this application, you are electronically signing this document.
                This electronic signature is legally binding and has the same effect as a handwritten signature under the
                <em>Personal Information Protection and Electronic Documents Act</em> (PIPEDA) and applicable provincial and state laws.
            </p>
            <p style="color:#1E40AF;font-size:.8125rem">
                Signature date &amp; time: <strong id="sigTimestamp">Will be recorded on submission</strong>
            </p>
        </div>

        <div class="consent-text">
            <label><input type="checkbox" id="consentCheck" required style="margin-right:.5rem">
            I confirm that the information provided on this application is true and complete. I authorize Alliance Financing Group Ltd., its agents and all third parties contacted regarding this financing facility to use this information to confirm the identity and creditworthiness of all parties listed. I agree that credit reports and credit information may be obtained from any credit reporting agency or credit grantor, and may be held, used, exchanged and disclosed for such purposes.</label>
        </div>

        <input type="hidden" id="referralSource" value="">
        <input type="hidden" id="formType" value="working-capital">

        <button type="button" class="submit-btn" id="submitBtn" onclick="submitWCApp()">Submit Working Capital Application</button>
    </div>

    <div class="form-card success-message" id="successMsg">
        <svg width="80" height="80" fill="none" stroke="#10B981" viewBox="0 0 24 24" style="margin:0 auto 1.5rem;display:block"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
        <h2 style="color:#10B981;font-size:1.75rem;margin-bottom:.5rem">Thank You for Your Application!</h2>
        <p style="font-size:1.125rem;color:#333;margin-bottom:.25rem">Your application has been successfully submitted.</p>
        <div style="background:#F0FDF4;border:2px solid #86EFAC;border-radius:.75rem;padding:1.25rem;margin:1.25rem auto;max-width:480px">
            <p style="margin:0 0 .5rem;color:#166534;font-size:.9375rem;font-weight:600">Your Tracking Number:</p>
            <p style="margin:0;font-size:1.5rem;font-weight:700;color:#065F46;letter-spacing:.05em" id="appId"></p>
        </div>
        <p style="color:#333;font-size:1rem;margin-bottom:.5rem">Please save this tracking number for your records.</p>
        <p style="color:#666;font-size:.9375rem;margin-bottom:1.25rem">Our team will review your application and contact you within <strong>24‚Äì48 business hours</strong>.</p>
        <div style="background:#EFF6FF;border:1px solid #BFDBFE;border-radius:.75rem;padding:1.25rem;margin-bottom:1.5rem;text-align:left">
            <h3 style="margin:0 0 .75rem;color:#1E40AF;font-size:1rem">üìç Track Your Application</h3>
            <p style="color:#1E40AF;font-size:.9375rem;margin:0 0 .75rem;line-height:1.6">Visit our website to check the status of your application at any time:</p>
            <a href="https://alliancefinancing.ai" target="_blank" style="display:inline-block;background:var(--primary);color:white;padding:.75rem 1.5rem;border-radius:.5rem;text-decoration:none;font-weight:600;font-size:1rem">Visit AllianceFinancing.ai</a>
        </div>
        <div class="doc-instructions">
            <h3>üìé Supporting Documents</h3>
            <p style="margin-bottom:.5rem;color:#166534">If you haven't already uploaded the following documents with your application, please forward them to <strong>info@alliancefinancing.ai</strong> with your Tracking Number in the subject line:</p>
            <ul>
                <li>Most recent 2 years of business financial statements (or tax returns)</li>
                <li>Most recent 6 months of business bank statements</li>
                <li>Accounts receivable aging report (if applying for factoring)</li>
                <li>Accounts payable aging report</li>
                <li>Government-issued ID for all owners/guarantors</li>
                <li>Void business cheque</li>
            </ul>
            <p style="margin-top:.75rem;color:#166534;font-size:.875rem">Files larger than 10MB can be emailed separately.</p>
        </div>
        <div id="agentContactInfo" style="display:none;background:#FEF3C7;border:1px solid #FCD34D;border-radius:.75rem;padding:1.25rem;margin-bottom:1.5rem;text-align:left">
            <h3 style="margin:0 0 .75rem;color:#92400E;font-size:1rem">üìû Your Agent Contact</h3>
            <p style="color:#92400E;font-size:.9375rem;margin:0;line-height:1.8" id="agentContactDetails"></p>
        </div>
        <div style="background:#F5F3FF;border:1px solid #C4B5FD;border-radius:.75rem;padding:1.25rem;text-align:left">
            <h3 style="margin:0 0 .5rem;color:#5B21B6;font-size:1rem">üí¨ Questions?</h3>
            <p style="color:#5B21B6;font-size:.9375rem;margin:0;line-height:1.6">Contact us at <strong><a href="mailto:info@alliancefinancing.ai" style="color:#5B21B6">info@alliancefinancing.ai</a></strong> or call <strong><a href="tel:+18776603660" style="color:#5B21B6">1-877-660-3660 ext. 222</a></strong></p>
        </div>
    </div>
</div>

<footer>
    <div class="footer-container">
        <div class="footer-brand"><h3>Alliance Financing Group Ltd.</h3><p>35 years of commercial financing expertise meets AI-powered technology.</p><p style="margin-top:1rem"><strong>Phone:</strong> <a href="tel:+18776603660" style="color:inherit;text-decoration:none">1-877-660-3660 ext. 222</a><br><strong>Email:</strong> <a href="mailto:info@alliancefinancing.ai" style="color:inherit;text-decoration:none">info@alliancefinancing.ai</a></p></div>
        <div class="footer-links"><h4>Products</h4><a href="working-capital.html">Working Capital</a><a href="equipment-financing.html">Equipment Financing</a><a href="lines-of-credit.html">Lines of Credit</a><a href="invoice-factoring.html">Invoice Factoring</a><a href="commercial-real-estate.html">Commercial Real Estate</a></div>
        <div class="footer-links"><h4>Company</h4><a href="about.html">About Us</a><a href="how-it-works.html">How It Works</a><a href="partners.html">Partners</a><a href="blog.html">Insights</a></div>
        <div class="footer-links"><h4>Legal</h4><a href="privacy-policy.html">Privacy Policy</a><a href="terms-of-service.html">Terms of Service</a><a href="faq.html">FAQ</a><a href="contact.html">Contact Us</a></div>
    </div>
    <div class="footer-bottom"><p>&copy; 2026 Alliance Financing Group Ltd. All rights reserved.</p></div>
</footer>

<script>
const SUPABASE_URL = 'https://uernphejrcsicnkobsdw.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVlcm5waGVqcmNzaWNua29ic2R3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA5MzU3ODksImV4cCI6MjA4NjUxMTc4OX0.A2YN3gkaYwR_9nyE3OkWl5Io9tfxe8lTgC913stXmUI';
const db = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// ============================================
// File Upload Handling
// ============================================
var selectedFinancials = [];
var selectedApar = [];

function setupDropZone(zoneId, inputId, fileArray, listId) {
    var dropZone = document.getElementById(zoneId);
    var fileInput = document.getElementById(inputId);
    if (!dropZone || !fileInput) return;

    dropZone.addEventListener('dragover', function(e) {
        e.preventDefault();
        dropZone.style.backgroundColor = '#EFF6FF';
    });
    dropZone.addEventListener('dragleave', function() {
        dropZone.style.backgroundColor = 'white';
    });
    dropZone.addEventListener('drop', function(e) {
        e.preventDefault();
        dropZone.style.backgroundColor = 'white';
        addFiles(e.dataTransfer.files, fileArray, listId);
    });
    fileInput.addEventListener('change', function(e) {
        addFiles(e.target.files, fileArray, listId);
    });
}

function addFiles(files, fileArray, listId) {
    var validTypes = ['application/pdf', 'image/jpeg', 'image/png'];
    var maxSize = 10 * 1024 * 1024;
    for (var i = 0; i < files.length; i++) {
        var file = files[i];
        if (!validTypes.includes(file.type)) { alert(file.name + ' is not a supported file type. Please upload PDF, PNG, or JPG files.'); continue; }
        if (file.size > maxSize) { alert(file.name + ' exceeds the 10MB limit.'); continue; }
        if (!fileArray.find(function(f) { return f.name === file.name && f.size === file.size; })) {
            fileArray.push(file);
        }
    }
    renderWCFileList(fileArray, listId);
}

function renderWCFileList(fileArray, listId) {
    var listDiv = document.getElementById(listId);
    if (fileArray.length === 0) { listDiv.innerHTML = ''; return; }
    listDiv.innerHTML = '<div style="margin-top:1rem"><strong style="color:#333;font-size:.9375rem">Selected Files (' + fileArray.length + '):</strong></div>' +
        fileArray.map(function(file, idx) {
            var fileSize = file.size < 1024 ? file.size + ' B' : file.size < 1048576 ? (file.size / 1024).toFixed(1) + ' KB' : (file.size / 1048576).toFixed(2) + ' MB';
            var icon = file.type === 'application/pdf' ? 'üìÑ' : 'üñºÔ∏è';
            return '<div style="display:flex;justify-content:space-between;align-items:center;padding:.75rem;background:#F9FAFB;border:1px solid #E5E7EB;border-radius:.5rem;margin-top:.5rem">' +
                '<div style="flex:1"><p style="margin:0;color:#333;font-weight:500;font-size:.9375rem">' + icon + ' ' + file.name + '</p>' +
                '<p style="margin:.25rem 0 0 0;color:#666;font-size:.875rem">' + fileSize + '</p></div>' +
                '<button type="button" onclick="removeWCFile(\'' + listId + '\',' + idx + ')" style="padding:.5rem .75rem;background:#FEE2E2;color:#DC2626;border:none;border-radius:.375rem;cursor:pointer;font-size:.875rem">Remove</button></div>';
        }).join('');
}

function removeWCFile(listId, idx) {
    if (listId === 'financialsFileList') { selectedFinancials.splice(idx, 1); renderWCFileList(selectedFinancials, listId); }
    else { selectedApar.splice(idx, 1); renderWCFileList(selectedApar, listId); }
}

document.addEventListener('DOMContentLoaded', function() {
    setupDropZone('dropZoneFinancials', 'financialsInput', selectedFinancials, 'financialsFileList');
    setupDropZone('dropZoneApar', 'aparInput', selectedApar, 'aparFileList');
});

// Clear red validation borders when user starts typing
document.addEventListener('input', function(e) {
    if (e.target.style && e.target.style.borderColor === 'rgb(239, 68, 68)') {
        e.target.style.borderColor = '';
    }
});
document.addEventListener('change', function(e) {
    if (e.target.style && e.target.style.borderColor === 'rgb(239, 68, 68)') {
        e.target.style.borderColor = '';
    }
});

// Capture referral from URL
(function(){
    var params=new URLSearchParams(window.location.search);
    var ref=params.get('ref')||params.get('referral')||'';
    if(ref){
        document.getElementById('referralSource').value=ref;
        document.getElementById('refBanner').style.display='block';
        document.getElementById('refName').textContent=ref.replace(/-/g,' ').replace(/\b\w/g,function(l){return l.toUpperCase()});
    }
})();

// Update signature timestamp as user types
document.getElementById('signatureName').addEventListener('input', function() {
    if (this.value.trim()) {
        document.getElementById('sigTimestamp').textContent = new Date().toLocaleString('en-US', {
            year: 'numeric', month: 'long', day: 'numeric',
            hour: '2-digit', minute: '2-digit', second: '2-digit', timeZoneName: 'short'
        });
    } else {
        document.getElementById('sigTimestamp').textContent = 'Will be recorded on submission';
    }
});

async function submitWCApp(){
    var btn=document.getElementById('submitBtn');

    // Validate e-signature
    var sigName = document.getElementById('signatureName').value.trim();
    if(!sigName){
        document.getElementById('signatureName').focus();
        document.getElementById('signatureName').style.borderColor='#EF4444';
        alert('Please enter your full legal name for the electronic signature.');
        return;
    }

    if(!document.getElementById('consentCheck').checked){alert('Please accept the consent and authorization.');return;}

    var required=['financingType','amountRequested','useOfFunds','legalName','bizAddress','bizCity','bizProv','bizPostal','bizPhone','contactName','bizEmail','dateIncorporated','taxId','annualSales','o1Name','o1Title','o1Pct','o1DOB','o1Address','bank1Name'];
    for(var i=0;i<required.length;i++){var el=document.getElementById(required[i]);if(!el.value.trim()){el.focus();el.style.borderColor='#EF4444';alert('Please fill in all required fields.');return;}}

    btn.disabled=true;btn.textContent='Submitting...';

    var appId='ALF-WC-'+Date.now().toString(36).toUpperCase();
    var now = new Date().toISOString();

    // Collect ALL form fields
    var fields=['financingType','amountRequested','useOfFunds','legalName','tradeName','bizAddress','bizCity','bizProv','bizPostal','bizCountry','bizPhone','bizFax','contactName','bizEmail','dateIncorporated','yrsOwner','taxId','numEmployees','annualSales','activeAccounts','o1Name','o1Title','o1Pct','o1Phone','o1DOB','o1Address','o1SinSsn','o2Name','o2Title','o2Pct','o2Phone','o2DOB','o2Address','bankruptcy','taxArrears','bank1Name','bank1Officer','bank1Acct','bank1Phone','hasLOC','locWith','locLimit','trade1Name','trade1Contact','trade1Phone','trade2Name','trade2Contact','trade2Phone','arOutstanding','arTerms','arMonthlySales','arActiveAccounts','arInvoiceSell','arMonthly','arPledged','arPledgedTo'];
    var formData={formType:'working-capital',applicationId:appId,submittedAt:now,referralSource:document.getElementById('referralSource').value,signatureName:sigName,signatureTimestamp:now};

    // Safely get structure radio
    var structureEl = document.querySelector('input[name="structure"]:checked');
    if (structureEl) formData.structure = structureEl.value;

    // Safely get home status radio
    var homeEl = document.querySelector('input[name="o1Home"]:checked');
    if (homeEl) formData.ownerHomeStatus = homeEl.value;

    fields.forEach(function(f){var el=document.getElementById(f);if(el)formData[f]=el.value;});

    // Map financing type to product
    var financingType = document.getElementById('financingType').value;
    var productMapping = {
        'Factoring': 'Factoring',
        'Working Capital': 'Working Capital',
        'Term Loan': 'Loans',
        'Operating Line': 'Business Line of Credit',
        'Purchase Order Financing': 'Trade Finance',
        'Inventory Financing': 'Working Capital',
        'SBL Loan': 'CSBFL',
        'Export Financing': 'Trade Finance',
        'Sale-Leaseback': 'Equipment Leasing'
    };
    var product = productMapping[financingType] || 'Working Capital';

    try {
        // Look up agent ID from referral slug
        var referralSlug = document.getElementById('referralSource').value;
        var sourceAgentId = null;
        if (referralSlug) {
            var { data: agentData, error: agentLookupErr } = await db.from('users').select('id, full_name, email, phone, referral_slug').ilike('referral_slug', referralSlug).maybeSingle();
            if (agentLookupErr) console.warn('Agent lookup error:', agentLookupErr);
            if (agentData) {
                sourceAgentId = agentData.id;
                formData.agentName = agentData.full_name || '';
                formData.agentEmail = agentData.email || '';
                formData.agentPhone = agentData.phone || '';
            }
        }

        // Parse funding amount
        var amtStr = document.getElementById('amountRequested').value.replace(/[$,]/g, '');
        var fundingAmount = parseFloat(amtStr) || null;
        var salesStr = document.getElementById('annualSales').value.replace(/[$,]/g, '');
        var annRevNum = parseFloat(salesStr) || 0;

        function getRevenueRange(val) {
            if (val < 500000) return 'Under $500k';
            if (val < 1000000) return '$500k - $1m';
            if (val < 5000000) return '$1m - $5M';
            if (val < 10000000) return '$5M - $10M';
            if (val < 25000000) return '$10M - $25M';
            return 'Over $25m';
        }
        var annualRevRange = annRevNum > 0 ? getRevenueRange(annRevNum) : null;

        // Map date incorporated to time_in_business enum
        function getTimeInBusinessEnum(dateStr) {
            var parts = dateStr.match(/(\d{1,2})\s*[\/\-]\s*(\d{4})/);
            if (!parts) {
                // Try just a year
                var yearMatch = dateStr.match(/(\d{4})/);
                if (yearMatch) {
                    var years = (new Date().getFullYear()) - parseInt(yearMatch[1]);
                    if (years < 1) return 'Less than 1 Year';
                    if (years < 2) return '1 - 2 years';
                    if (years < 5) return '2 - 5 years';
                    if (years < 10) return '5 - 10 years';
                    return 'Over 10 years';
                }
                return null;
            }
            var startDate = new Date(parseInt(parts[2]), parseInt(parts[1]) - 1, 1);
            var years = (new Date() - startDate) / (365.25 * 24 * 60 * 60 * 1000);
            if (years < 1) return 'Less than 1 Year';
            if (years < 2) return '1 - 2 years';
            if (years < 5) return '2 - 5 years';
            if (years < 10) return '5 - 10 years';
            return 'Over 10 years';
        }
        var timeInBizEnum = getTimeInBusinessEnum(document.getElementById('dateIncorporated').value);

        // Insert into applications table
        var { data: appData, error: appError } = await db.from('applications').insert([{
            application_id: appId,
            full_name: document.getElementById('o1Name').value,
            email: document.getElementById('bizEmail').value,
            phone: document.getElementById('bizPhone').value,
            business_name: document.getElementById('legalName').value,
            time_in_business: timeInBizEnum,
            annual_revenue: annualRevRange,
            funding_amount_requested: fundingAmount,
            funding_amount_text: document.getElementById('amountRequested').value,
            description: financingType + ' - ' + document.getElementById('useOfFunds').value.substring(0, 200),
            source_agent_id: sourceAgentId,
            source_channel: referralSlug ? 'Agent Referral' : 'Online',
            referral_slug: referralSlug || null,
            status: 'Application Received',
            submitted_at: now,
            form_type: 'working-capital',
            form_data: formData,
            signature_name: sigName,
            signature_timestamp: now
        }]).select();

        if (appError) throw appError;

        // Insert product
        if (appData && appData.length > 0) {
            await db.from('application_products').insert([{
                application_id: appData[0].id,
                product: product
            }]);
        }

        // Upload financial statements and AP/AR documents
        var allUploads = [];
        selectedFinancials.forEach(function(f) { allUploads.push({ file: f, docType: 'financial_statements' }); });
        selectedApar.forEach(function(f) { allUploads.push({ file: f, docType: 'ap_ar_aging' }); });

        if (allUploads.length > 0 && appData && appData.length > 0) {
            var appUUID = appData[0].id;
            document.getElementById('wcUploadProgress').style.display = 'block';
            for (var fi = 0; fi < allUploads.length; fi++) {
                var item = allUploads[fi];
                var file = item.file;
                var filePath = 'applications/' + appUUID + '/' + Date.now() + '-' + file.name.replace(/[^a-zA-Z0-9._-]/g, '_');
                var { data: uploadData, error: uploadError } = await db.storage
                    .from('deal-documents').upload(filePath, file);
                if (uploadError) { console.warn('Upload error for ' + file.name + ':', uploadError); continue; }
                await db.from('documents').insert([{
                    application_id: appUUID,
                    file_name: file.name,
                    file_path: filePath,
                    file_type: file.type,
                    file_size_bytes: file.size,
                    document_type: item.docType,
                    uploaded_by_name: document.getElementById('o1Name').value || 'Applicant',
                    notes: 'Uploaded with working capital application ' + appId
                }]);
                var progress = ((fi + 1) / allUploads.length) * 100;
                document.getElementById('wcProgressBar').style.width = progress + '%';
                document.getElementById('wcProgressText').textContent = 'Uploaded ' + (fi + 1) + ' of ' + allUploads.length + ' files';
            }
        }

        // Show success
        document.getElementById('formCard').style.display='none';
        document.getElementById('successMsg').style.display='block';
        document.getElementById('appId').textContent=appId;
        document.getElementById('wcUploadProgress').style.display='none';

        // Show agent contact info if from referral
        if (formData.agentName) {
            var agentInfo = '<strong>' + formData.agentName + '</strong>';
            if (formData.agentEmail) agentInfo += '<br>Email: <a href="mailto:' + formData.agentEmail + '" style="color:#92400E">' + formData.agentEmail + '</a>';
            if (formData.agentPhone) agentInfo += '<br>Phone: <a href="tel:' + formData.agentPhone.replace(/[^+\d]/g,'') + '" style="color:#92400E">' + formData.agentPhone + '</a>';
            document.getElementById('agentContactDetails').innerHTML = agentInfo;
            document.getElementById('agentContactInfo').style.display = 'block';
        }

        window.scrollTo({top:0,behavior:'smooth'});

    } catch(error) {
        console.error('Submission error:', error);
        alert('There was an error submitting your application. Please try again or contact us at info@alliancefinancing.ai\n\nError: ' + (error.message || 'Unknown error'));
        btn.disabled=false;
        btn.textContent='Submit Application';
    }
}
</script>
</body>
</html>
