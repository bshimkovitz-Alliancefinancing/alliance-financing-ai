<!DOCTYPE html>
<html lang="en">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FHD2GL25L"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date());gtag('config','G-FHD2GL25L');</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Merchant Cash Advance Application - Alliance Financing AI</title>
    <meta name="description" content="Apply for a merchant cash advance. Get funded in as little as 24-48 hours based on your future sales. No collateral required.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
nav{position:fixed;top:0;width:100%;background:rgba(255,255,255,.95);backdrop-filter:blur(12px);border-bottom:1px solid #e2e8f0;z-index:1000;padding:1.25rem 0}
.nav-container{max-width:1200px;margin:0 auto;padding:0 2rem;display:grid;grid-template-columns:auto 1fr auto;align-items:center}
.logo{display:flex;align-items:center;text-decoration:none}
.nav-links{display:flex;gap:1.75rem;align-items:center;justify-content:center}
.nav-links a{color:#0F172A;text-decoration:none;font-size:.9375rem;font-weight:600;transition:all .2s;position:relative}
.nav-links a:hover{color:#2563EB}
.nav-links a::after{content:'';position:absolute;bottom:-4px;left:0;width:0;height:2px;background:#2563EB;transition:width .2s}
.nav-links a:hover::after{width:100%}
.nav-cta{justify-self:end;display:flex;gap:1rem}
.btn-outline{background:#fff;color:#334155;border:2px solid #e2e8f0;padding:.75rem 1.5rem;border-radius:.5rem;font-weight:600;cursor:pointer;text-decoration:none;font-size:.9375rem;transition:all .2s}
.btn-outline:hover{border-color:#2563EB;color:#2563EB}
.btn-primary{background:#2563EB;color:#fff;padding:.75rem 1.5rem;border-radius:.5rem;border:none;font-weight:600;cursor:pointer;text-decoration:none;font-size:.9375rem;transition:all .2s}
.btn-primary:hover{background:#1E40AF}
.mobile-menu-btn{display:none;background:#2563EB;border:none;cursor:pointer;padding:.75rem 1.5rem;border-radius:.5rem;color:#fff;font-weight:600;font-size:.9375rem}
@media(max-width:768px){.nav-links,.nav-cta{display:none!important}.mobile-menu-btn{display:block!important}.nav-container{grid-template-columns:auto auto!important}}

*{margin:0;padding:0;box-sizing:border-box}
:root{--primary:#2563EB;--primary-dark:#1E40AF;--slate-50:#F8FAFC;--slate-100:#F1F5F9;--slate-200:#E2E8F0;--slate-600:#475569;--slate-800:#1E293B;--slate-900:#0F172A;--white:#fff;--font:'DM Sans',-apple-system,sans-serif}
body{font-family:var(--font);background:var(--slate-50);color:var(--slate-800);line-height:1.6}
.hero{padding:7rem 2rem 3rem;background:linear-gradient(135deg,#EEF2FF,#F5F3FF);text-align:center}
.hero h1{font-size:clamp(2rem,4vw,2.75rem);font-weight:700;color:var(--slate-900);margin-bottom:.75rem}
.hero p{font-size:1.125rem;color:var(--slate-600);max-width:650px;margin:0 auto}
.form-container{max-width:800px;margin:-2rem auto 4rem;padding:0 1.5rem}
.form-card{background:var(--white);border-radius:1rem;padding:2.5rem;box-shadow:0 4px 20px rgba(0,0,0,.06);border:1px solid var(--slate-200)}
.section-title{font-size:1.25rem;font-weight:700;color:var(--slate-900);margin:2rem 0 1rem;padding-bottom:.5rem;border-bottom:2px solid var(--primary)}
.section-title:first-child{margin-top:0}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:1rem}
.form-row.three{grid-template-columns:1fr 1fr 1fr}
.form-row.four{grid-template-columns:1fr 1fr 1fr 1fr}
.form-group{display:flex;flex-direction:column}
.form-group.full{grid-column:1/-1}
.form-group label{font-size:.8125rem;font-weight:600;color:var(--slate-600);margin-bottom:.25rem}
.form-group input,.form-group select,.form-group textarea{padding:.625rem .75rem;border:1.5px solid var(--slate-200);border-radius:.5rem;font-size:.9375rem;font-family:var(--font);transition:border .2s;outline:none;width:100%;box-sizing:border-box}
.form-group input:focus,.form-group select:focus,.form-group textarea:focus{border-color:var(--primary);box-shadow:0 0 0 3px rgba(37,99,235,.1)}
.form-group textarea{resize:vertical;min-height:80px}
.checkbox-row{display:flex;gap:1.5rem;align-items:center;margin-bottom:1rem;flex-wrap:wrap}
.checkbox-row label{display:flex;align-items:center;gap:.375rem;font-size:.9375rem;cursor:pointer;font-weight:500}
.checkbox-row input[type="radio"]{width:18px;height:18px;accent-color:var(--primary)}
.principal-block{background:var(--slate-50);border:1px solid var(--slate-200);border-radius:.75rem;padding:1.5rem;margin-bottom:1rem}
.submit-btn{width:100%;padding:1rem;background:var(--primary);color:#fff;border:none;border-radius:.75rem;font-size:1.0625rem;font-weight:600;cursor:pointer;transition:background .2s;margin-top:1.5rem}
.submit-btn:hover{background:var(--primary-dark)}
.submit-btn:disabled{background:#94A3B8;cursor:not-allowed}
.consent-text{font-size:.75rem;color:var(--slate-600);line-height:1.6;margin-top:1.5rem;padding:1rem;background:var(--slate-50);border-radius:.5rem;border:1px solid var(--slate-200)}
.success-message{display:none;text-align:center;padding:3rem 2rem}
.success-message h2{color:#10B981;font-size:1.75rem;margin-bottom:1rem}
.success-message p{color:var(--slate-600);font-size:1.0625rem;margin-bottom:.5rem}
.doc-instructions{background:#ECFDF5;border:1px solid #BBF7D0;border-radius:.75rem;padding:1.5rem;margin-top:1.5rem;text-align:left}
.doc-instructions h3{color:#166534;font-size:1rem;margin-bottom:.75rem}
.doc-instructions ul{list-style:disc;padding-left:1.25rem;color:#166534;font-size:.9375rem}
.doc-instructions ul li{margin-bottom:.25rem}
.ref-banner{background:linear-gradient(135deg,#2563EB,#7C3AED);color:#fff;text-align:center;padding:.5rem 1rem;font-size:.875rem}
.ref-banner strong{font-weight:700}
.trust-badges{display:flex;justify-content:center;gap:2rem;margin-top:1.5rem;flex-wrap:wrap}
.trust-badge{display:flex;align-items:center;gap:.375rem;font-size:.8125rem;color:var(--slate-600);font-weight:500}
.trust-badge svg{width:16px;height:16px;stroke:#10B981;fill:none}
.info-box{background:#EFF6FF;border:1px solid #BFDBFE;border-radius:.75rem;padding:1.25rem;margin-bottom:1.5rem}
.info-box h3{color:#1E40AF;font-size:.9375rem;margin-bottom:.5rem}
.info-box p{color:#1E40AF;font-size:.875rem;line-height:1.6}
@media(max-width:768px){.form-row,.form-row.three,.form-row.four{grid-template-columns:1fr}.form-card{padding:1.5rem}.checkbox-row{flex-direction:column;gap:.75rem;align-items:flex-start}}
footer{background:#0F172A;color:#94A3B8;padding:3rem 0 0}
.footer-container{max-width:1200px;margin:0 auto;padding:0 2rem;display:grid;grid-template-columns:2fr 1fr 1fr 1fr;gap:3rem}
.footer-brand h3{color:#fff;font-size:1.25rem;margin-bottom:.75rem}
.footer-brand p{font-size:.9375rem;line-height:1.7}
.footer-links{display:flex;flex-direction:column;gap:.625rem}
.footer-links h4{color:#fff;font-size:.9375rem;font-weight:600;margin-bottom:.5rem}
.footer-links a{color:#94A3B8;text-decoration:none;font-size:.875rem;transition:color .2s}
.footer-links a:hover{color:#fff}
.footer-bottom{max-width:1200px;margin:2rem auto 0;padding:1.5rem 2rem;border-top:1px solid #1E293B;display:flex;justify-content:space-between;font-size:.875rem}
@media(max-width:768px){.footer-container{grid-template-columns:1fr;gap:2rem}.footer-bottom{flex-direction:column;gap:1rem;text-align:center}}
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

<div id="refBanner" class="ref-banner" style="display:none">Referred by: <strong id="refName"></strong></div>

<nav>
    <div class="nav-container">
        <a href="index.html" class="logo"><img src="alliance-logo-transparent.png" alt="Alliance Financing Group" style="height:36px;width:auto"></a>
        <div class="nav-links"><a href="index.html">Home</a><a href="how-it-works.html">How It Works</a><a href="products.html">Products</a><a href="partners.html">Partners</a><a href="blog.html">Insights</a><a href="track-application.html">Track Application</a></div>
        <div class="nav-cta"><a href="contact.html" class="btn-outline">Contact Us</a><a href="application.html" class="btn-primary">Apply Now</a></div>
        <button class="mobile-menu-btn" onclick="window.location.href='application.html'">Apply Now</button>
    </div>
</nav>

<section class="hero">
    <h1>Merchant Cash Advance Application</h1>
    <p>Get funded in as little as 24-48 hours based on your future sales. No collateral required, flexible repayment tied to your daily revenue.</p>
    <div class="trust-badges">
        <span class="trust-badge"><svg viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>256-bit SSL Encrypted</span>
        <span class="trust-badge"><svg viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>Funded in 24-48 Hours</span>
        <span class="trust-badge"><svg viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>No Collateral Needed</span>
    </div>
</section>

<div class="form-container">
    <div class="form-card" id="formCard">

        <div class="info-box">
            <h3>How Merchant Cash Advances Work</h3>
            <p>A merchant cash advance provides a lump sum of capital in exchange for a percentage of your future sales. Repayment is automatic and adjusts with your daily revenue ‚Äî when sales are slower, you pay less. Ideal for businesses with strong card sales or consistent daily revenue.</p>
        </div>

        <div class="section-title">Funding Request</div>
        <div class="form-row">
            <div class="form-group">
                <label>Advance Amount Requested ($) *</label>
                <input type="text" id="advanceAmount" required placeholder="e.g. $50,000">
            </div>
            <div class="form-group">
                <label>Purpose of Funds *</label>
                <select id="fundsPurpose" required>
                    <option value="">Select...</option>
                    <option value="Working Capital">Working Capital</option>
                    <option value="Inventory Purchase">Inventory Purchase</option>
                    <option value="Equipment">Equipment</option>
                    <option value="Expansion">Business Expansion</option>
                    <option value="Renovation">Renovation / Build-out</option>
                    <option value="Payroll">Payroll</option>
                    <option value="Marketing">Marketing / Advertising</option>
                    <option value="Debt Consolidation">Debt Consolidation</option>
                    <option value="Other">Other</option>
                </select>
            </div>
        </div>

        <div class="section-title">Business Information</div>
        <div class="form-row">
            <div class="form-group"><label>Business Legal Name *</label><input type="text" id="legalName" required></div>
            <div class="form-group"><label>DBA / Trade Name</label><input type="text" id="tradeName"></div>
        </div>
        <div class="form-group full" style="margin-bottom:1rem"><label>Business Address *</label><input type="text" id="bizAddress" required></div>
        <div class="form-row four">
            <div class="form-group"><label>City *</label><input type="text" id="bizCity" required></div>
            <div class="form-group"><label>Prov/State *</label><input type="text" id="bizProv" required></div>
            <div class="form-group"><label>Postal/Zip *</label><input type="text" id="bizPostal" required></div>
            <div class="form-group"><label>Country *</label><select id="bizCountry" required><option value="Canada">Canada</option><option value="United States">United States</option></select></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label>Business Phone *</label><input type="tel" id="bizPhone" required></div>
            <div class="form-group"><label>Business Email *</label><input type="email" id="bizEmail" required></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label>GST or Federal ID Number *</label><input type="text" id="gstFedId" required placeholder="e.g. 123456789 RT0001"></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label>Industry / Type of Business *</label><input type="text" id="industry" required placeholder="e.g. Restaurant, Retail, Auto Repair"></div>
            <div class="form-group"><label>Time in Business *</label>
                <select id="timeInBusiness" required>
                    <option value="">Select...</option>
                    <option value="Less than 1 Year">Less than 1 Year</option>
                    <option value="1 - 2 years">1 - 2 years</option>
                    <option value="2 - 5 years">2 - 5 years</option>
                    <option value="5 - 10 years">5 - 10 years</option>
                    <option value="Over 10 years">Over 10 years</option>
                </select>
            </div>
        </div>
        <div class="checkbox-row">
            <label><strong style="margin-right:.5rem">Structure:</strong></label>
            <label><input type="radio" name="structure" value="Corporation" checked> Corporation</label>
            <label><input type="radio" name="structure" value="LLC"> LLC</label>
            <label><input type="radio" name="structure" value="Partnership"> Partnership</label>
            <label><input type="radio" name="structure" value="Proprietorship"> Sole Proprietorship</label>
        </div>

        <div class="section-title">Revenue Information</div>
        <div class="form-row">
            <div class="form-group"><label>Average Monthly Revenue ($) *</label><input type="text" id="monthlyRevenue" required placeholder="e.g. $80,000"></div>
            <div class="form-group"><label>Average Monthly Credit/Debit Card Sales ($) *</label><input type="text" id="cardSales" required placeholder="e.g. $50,000"></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label>Annual Gross Revenue ($) *</label><input type="text" id="annualRevenue" required placeholder="e.g. $960,000"></div>
            <div class="form-group"><label>Number of Employees</label><input type="text" id="numEmployees"></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label>Merchant Processing Company</label><input type="text" id="processor" placeholder="e.g. Square, Clover, Stripe"></div>
            <div class="form-group"><label>Bank Name *</label><input type="text" id="bankName" required></div>
        </div>

        <div class="section-title">Existing Obligations</div>
        <div class="form-row">
            <div class="form-group"><label>Current Cash Advance Outstanding?</label><select id="currentMCA"><option value="No">No</option><option value="Yes">Yes</option></select></div>
            <div class="form-group"><label>If Yes, Current Balance ($)</label><input type="text" id="mcaBalance" placeholder="Remaining balance"></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label>Existing Business Loans?</label><select id="existingLoans"><option value="No">No</option><option value="Yes">Yes</option></select></div>
            <div class="form-group"><label>If Yes, Monthly Payment ($)</label><input type="text" id="loanPayment"></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label>Any Tax Liens or Judgments?</label><select id="taxLiens"><option value="No">No</option><option value="Yes">Yes</option></select></div>
            <div class="form-group"><label>Business in Arrears for Taxes?</label><select id="taxArrears"><option value="No">No</option><option value="Yes">Yes</option></select></div>
        </div>

        <div class="section-title">Owner Information *</div>
        <div class="principal-block">
            <div class="form-row">
                <div class="form-group"><label>Owner Full Name *</label><input type="text" id="ownerName" required></div>
                <div class="form-group"><label>Title *</label><input type="text" id="ownerTitle" required placeholder="e.g. Owner, President, CEO"></div>
            </div>
            <div class="form-row three">
                <div class="form-group"><label>% Ownership *</label><input type="text" id="ownerPct" required placeholder="e.g. 100%"></div>
                <div class="form-group"><label>Date of Birth *</label><input type="date" id="ownerDOB" required></div>
                <div class="form-group"><label>Cell Phone *</label><input type="tel" id="ownerPhone" required></div>
            </div>
            <div class="form-group full" style="margin-bottom:1rem"><label>Home Address *</label><input type="text" id="ownerAddress" required placeholder="Full address including city, province/state, postal/zip"></div>
            <div class="form-group full"><label>Email *</label><input type="email" id="ownerEmail" required></div>
            <div class="form-group full"><label>SIN (Canada) or SSN (US) ‚Äî <em>Optional</em></label><input type="text" id="ownerSinSsn" placeholder="e.g. 123-456-789" maxlength="11"></div>
        </div>

        <div class="section-title">Second Owner (if applicable)</div>
        <div class="principal-block">
            <div class="form-row">
                <div class="form-group"><label>Owner Full Name</label><input type="text" id="owner2Name"></div>
                <div class="form-group"><label>Title</label><input type="text" id="owner2Title"></div>
            </div>
            <div class="form-row three">
                <div class="form-group"><label>% Ownership</label><input type="text" id="owner2Pct"></div>
                <div class="form-group"><label>Date of Birth</label><input type="date" id="owner2DOB"></div>
                <div class="form-group"><label>Cell Phone</label><input type="tel" id="owner2Phone"></div>
            </div>
        </div>

        <div class="section-title">Supporting Documents</div>
        <div style="background:#F0F9FF;border:1px solid #BFDBFE;border-radius:.75rem;padding:1.25rem;margin-bottom:1.5rem">
            <h3 style="color:#1E40AF;font-size:.9375rem;margin-bottom:.75rem;margin-top:0">Bank Statements Upload (Optional)</h3>
            <p style="color:#1E40AF;font-size:.875rem;margin-bottom:1rem;line-height:1.6">Upload your last 6 months of bank statements now, or email them to <strong>info@alliancefinancing.ai</strong> with your Application ID after submission.</p>
            <div id="dropZone" style="border:2px dashed #3B82F6;border-radius:.75rem;padding:2rem;text-align:center;cursor:pointer;transition:all .2s;background:white" onclick="document.getElementById('bankStatementsInput').click()">
                <svg style="width:32px;height:32px;margin:0 auto .75rem;color:#3B82F6;display:block" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
                <p style="margin:0 0 .5rem;color:#333;font-weight:500">Drag and drop PDFs or images here, or click to select</p>
                <p style="margin:0;color:#666;font-size:.875rem">PDF, PNG, JPG ‚Äî max 10MB per file</p>
                <input type="file" id="bankStatementsInput" multiple accept=".pdf,.png,.jpg,.jpeg" style="display:none">
            </div>
            <div id="uploadedFilesList"></div>
            <div id="uploadProgress" style="display:none;margin-top:1rem">
                <div style="width:100%;height:8px;background:#E5E7EB;border-radius:4px;overflow:hidden">
                    <div id="progressBar" style="width:0%;height:100%;background:#10B981;transition:width .3s"></div>
                </div>
                <p id="progressText" style="margin-top:.5rem;font-size:.875rem;color:#666"></p>
            </div>
        </div>

        <div class="section-title">E-Signature & Authorization</div>
        <div class="form-group full" style="margin-bottom:1rem">
            <label>Print Your Full Legal Name (Electronic Signature) *</label>
            <input type="text" id="signatureName" required placeholder="Your full legal name as it appears on official ID" style="font-size:1.1rem;font-weight:600;border:2px solid var(--primary);padding:.75rem">
        </div>
        <div style="background:#EFF6FF;border:1px solid #BFDBFE;border-radius:.75rem;padding:1.25rem;margin-bottom:1rem">
            <p style="color:#1E40AF;font-size:.875rem;line-height:1.6;margin-bottom:.5rem">
                By typing your name above and submitting this application, you are electronically signing this document.
                This electronic signature is legally binding and has the same effect as a handwritten signature under the
                <em>Personal Information Protection and Electronic Documents Act</em> (PIPEDA) and applicable provincial and state laws.
            </p>
            <p style="color:#1E40AF;font-size:.8125rem">
                Signature date &amp; time: <strong id="sigTimestamp">Will be recorded on submission</strong>
            </p>
        </div>

        <div class="consent-text">
            <label><input type="checkbox" id="consentCheck" required style="margin-right:.5rem">
            I confirm that the information provided is true and complete. I authorize Alliance Financing Group Ltd. and its partners to obtain credit reports, verify business information with banks, merchant processors, and third parties, and to use this information to evaluate this application. I understand that a merchant cash advance is a purchase of future receivables and not a loan.</label>
        </div>

        <input type="hidden" id="referralSource" value="">
        <input type="hidden" id="formType" value="merchant-advance">

        <button type="button" class="submit-btn" id="submitBtn" onclick="submitMCAApp()">Submit Merchant Advance Application</button>
    </div>

    <div class="form-card success-message" id="successMsg">
        <svg width="80" height="80" fill="none" stroke="#10B981" viewBox="0 0 24 24" style="margin:0 auto 1.5rem;display:block"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
        <h2 style="color:#10B981;font-size:1.75rem;margin-bottom:.5rem">Thank You for Your Application!</h2>
        <p style="font-size:1.125rem;color:#333;margin-bottom:.25rem">Your application has been successfully submitted.</p>
        <div style="background:#F0FDF4;border:2px solid #86EFAC;border-radius:.75rem;padding:1.25rem;margin:1.25rem auto;max-width:480px">
            <p style="margin:0 0 .5rem;color:#166534;font-size:.9375rem;font-weight:600">Your Tracking Number:</p>
            <p style="margin:0;font-size:1.5rem;font-weight:700;color:#065F46;letter-spacing:.05em" id="appId"></p>
        </div>
        <p style="color:#333;font-size:1rem;margin-bottom:.5rem">Please save this tracking number for your records.</p>
        <p style="color:#666;font-size:.9375rem;margin-bottom:1.25rem">Our team will review your application and contact you within <strong>24‚Äì48 business hours</strong>.</p>
        <div style="background:#EFF6FF;border:1px solid #BFDBFE;border-radius:.75rem;padding:1.25rem;margin-bottom:1.5rem;text-align:left">
            <h3 style="margin:0 0 .75rem;color:#1E40AF;font-size:1rem">üìç Track Your Application</h3>
            <p style="color:#1E40AF;font-size:.9375rem;margin:0 0 .75rem;line-height:1.6">Visit our website to check the status of your application at any time:</p>
            <a href="https://alliancefinancing.ai" target="_blank" style="display:inline-block;background:var(--primary);color:white;padding:.75rem 1.5rem;border-radius:.5rem;text-decoration:none;font-weight:600;font-size:1rem">Visit AllianceFinancing.ai</a>
        </div>
        <div class="doc-instructions">
            <h3>üìé Supporting Documents Required</h3>
            <p style="margin-bottom:.5rem;color:#166534">Please email the following to <strong>info@alliancefinancing.ai</strong> with your Tracking Number in the subject line:</p>
            <ul>
                <li>Last 4 months of business bank statements</li>
                <li>Last 4 months of merchant processing statements</li>
                <li>Government-issued photo ID for all owners</li>
                <li>Void business cheque</li>
                <li>Copy of business license (if applicable)</li>
            </ul>
        </div>
    </div>
</div>

<footer>
    <div class="footer-container">
        <div class="footer-brand"><h3>Alliance Financing Group Ltd.</h3><p>35 years of commercial financing expertise meets AI-powered technology.</p><p style="margin-top:1rem"><strong>Phone:</strong> <a href="tel:+18776603660" style="color:inherit;text-decoration:none">1-877-660-3660 ext. 222</a><br><strong>Email:</strong> <a href="mailto:info@alliancefinancing.ai" style="color:inherit;text-decoration:none">info@alliancefinancing.ai</a></p></div>
        <div class="footer-links"><h4>Products</h4><a href="working-capital.html">Working Capital</a><a href="equipment-financing.html">Equipment Financing</a><a href="lines-of-credit.html">Lines of Credit</a><a href="invoice-factoring.html">Invoice Factoring</a><a href="commercial-real-estate.html">Commercial Real Estate</a></div>
        <div class="footer-links"><h4>Company</h4><a href="about.html">About Us</a><a href="how-it-works.html">How It Works</a><a href="partners.html">Partners</a><a href="blog.html">Insights</a></div>
        <div class="footer-links"><h4>Legal</h4><a href="privacy-policy.html">Privacy Policy</a><a href="terms-of-service.html">Terms of Service</a><a href="faq.html">FAQ</a><a href="contact.html">Contact Us</a></div>
    </div>
    <div class="footer-bottom"><p>&copy; 2026 Alliance Financing Group Ltd. All rights reserved.</p></div>
</footer>

<script>
const SUPABASE_URL = 'https://uernphejrcsicnkobsdw.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVlcm5waGVqcmNzaWNua29ic2R3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA5MzU3ODksImV4cCI6MjA4NjUxMTc4OX0.A2YN3gkaYwR_9nyE3OkWl5Io9tfxe8lTgC913stXmUI';
const db = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// ============================================
// File Upload Handling
// ============================================
var selectedBankStatements = [];

(function initFileUpload() {
    document.addEventListener('DOMContentLoaded', function() {
        var dropZone = document.getElementById('dropZone');
        var fileInput = document.getElementById('bankStatementsInput');

        dropZone.addEventListener('dragover', function(e) {
            e.preventDefault();
            dropZone.style.backgroundColor = '#EFF6FF';
            dropZone.style.borderColor = '#2563EB';
        });
        dropZone.addEventListener('dragleave', function() {
            dropZone.style.backgroundColor = 'white';
            dropZone.style.borderColor = '#3B82F6';
        });
        dropZone.addEventListener('drop', function(e) {
            e.preventDefault();
            dropZone.style.backgroundColor = 'white';
            dropZone.style.borderColor = '#3B82F6';
            handleFileSelection(e.dataTransfer.files);
        });
        fileInput.addEventListener('change', function(e) {
            handleFileSelection(e.target.files);
        });
    });
})();

function handleFileSelection(files) {
    var validTypes = ['application/pdf', 'image/jpeg', 'image/png'];
    var maxSize = 10 * 1024 * 1024;
    for (var i = 0; i < files.length; i++) {
        var file = files[i];
        if (!validTypes.includes(file.type)) { alert(file.name + ' is not a supported file type. Please upload PDF, PNG, or JPG files.'); continue; }
        if (file.size > maxSize) { alert(file.name + ' exceeds the 10MB limit.'); continue; }
        if (!selectedBankStatements.find(function(f) { return f.name === file.name && f.size === file.size; })) {
            selectedBankStatements.push(file);
        }
    }
    renderFilesList();
}

function renderFilesList() {
    var listDiv = document.getElementById('uploadedFilesList');
    if (selectedBankStatements.length === 0) { listDiv.innerHTML = ''; return; }
    listDiv.innerHTML = '<div style="margin-top:1rem"><strong style="color:#333;font-size:.9375rem">Selected Files (' + selectedBankStatements.length + '):</strong></div>' +
        selectedBankStatements.map(function(file, idx) {
            var sizeMB = (file.size / 1024 / 1024).toFixed(2);
            var icon = file.type === 'application/pdf' ? 'üìÑ' : 'üñºÔ∏è';
            return '<div style="display:flex;justify-content:space-between;align-items:center;padding:.75rem;background:#F9FAFB;border:1px solid #E5E7EB;border-radius:.5rem;margin-top:.5rem">' +
                '<div style="flex:1"><p style="margin:0;color:#333;font-weight:500;font-size:.9375rem">' + icon + ' ' + file.name + '</p>' +
                '<p style="margin:.25rem 0 0 0;color:#666;font-size:.875rem">' + sizeMB + ' MB</p></div>' +
                '<button type="button" onclick="removeFile(' + idx + ')" style="padding:.5rem .75rem;background:#FEE2E2;color:#DC2626;border:none;border-radius:.375rem;cursor:pointer;font-size:.875rem">Remove</button></div>';
        }).join('');
}

function removeFile(idx) {
    selectedBankStatements.splice(idx, 1);
    renderFilesList();
}

// Clear red validation borders when user starts typing
document.addEventListener('input', function(e) {
    if (e.target.style && e.target.style.borderColor === 'rgb(239, 68, 68)') {
        e.target.style.borderColor = '';
    }
});
document.addEventListener('change', function(e) {
    if (e.target.style && e.target.style.borderColor === 'rgb(239, 68, 68)') {
        e.target.style.borderColor = '';
    }
});

// Capture referral from URL
(function(){
    var params=new URLSearchParams(window.location.search);
    var ref=params.get('ref')||params.get('referral')||'';
    if(ref){
        document.getElementById('referralSource').value=ref;
        document.getElementById('refBanner').style.display='block';
        document.getElementById('refName').textContent=ref.replace(/-/g,' ').replace(/\b\w/g,function(l){return l.toUpperCase()});
    }
})();

// Update signature timestamp as user types
document.getElementById('signatureName').addEventListener('input', function() {
    if (this.value.trim()) {
        document.getElementById('sigTimestamp').textContent = new Date().toLocaleString('en-US', {
            year: 'numeric', month: 'long', day: 'numeric',
            hour: '2-digit', minute: '2-digit', second: '2-digit', timeZoneName: 'short'
        });
    } else {
        document.getElementById('sigTimestamp').textContent = 'Will be recorded on submission';
    }
});

async function submitMCAApp(){
    var btn=document.getElementById('submitBtn');

    // Validate e-signature
    var sigName = document.getElementById('signatureName').value.trim();
    if(!sigName){
        document.getElementById('signatureName').focus();
        document.getElementById('signatureName').style.borderColor='#EF4444';
        alert('Please enter your full legal name for the electronic signature.');
        return;
    }

    if(!document.getElementById('consentCheck').checked){alert('Please accept the consent and authorization.');return;}

    var required=['advanceAmount','fundsPurpose','legalName','bizAddress','bizCity','bizProv','bizPostal','bizPhone','bizEmail','gstFedId','industry','timeInBusiness','monthlyRevenue','cardSales','annualRevenue','bankName','ownerName','ownerTitle','ownerPct','ownerDOB','ownerPhone','ownerAddress','ownerEmail'];
    for(var i=0;i<required.length;i++){var el=document.getElementById(required[i]);if(!el.value.trim()){el.focus();el.style.borderColor='#EF4444';alert('Please fill in all required fields.');return;}}

    btn.disabled=true;btn.textContent='Submitting...';

    var appId='ALF-MCA-'+Date.now().toString(36).toUpperCase();
    var now = new Date().toISOString();

    // Collect ALL form fields
    var fields=['advanceAmount','fundsPurpose','legalName','tradeName','bizAddress','bizCity','bizProv','bizPostal','bizCountry','bizPhone','bizEmail','gstFedId','industry','timeInBusiness','numEmployees','monthlyRevenue','cardSales','annualRevenue','processor','bankName','currentMCA','mcaBalance','existingLoans','loanPayment','taxLiens','taxArrears','ownerName','ownerTitle','ownerPct','ownerDOB','ownerPhone','ownerAddress','ownerEmail','ownerSinSsn','owner2Name','owner2Title','owner2Pct','owner2DOB','owner2Phone'];
    var formData={formType:'merchant-advance',applicationId:appId,submittedAt:now,referralSource:document.getElementById('referralSource').value,structure:document.querySelector('input[name="structure"]:checked').value,signatureName:sigName,signatureTimestamp:now};
    fields.forEach(function(f){var el=document.getElementById(f);if(el)formData[f]=el.value;});

    try {
        // Look up agent ID from referral slug
        var referralSlug = document.getElementById('referralSource').value;
        var sourceAgentId = null;
        if (referralSlug) {
            var { data: agentData } = await db.from('users').select('id').eq('referral_slug', referralSlug).maybeSingle();
            if (agentData) sourceAgentId = agentData.id;
        }

        // Parse funding amount
        var amtStr = document.getElementById('advanceAmount').value.replace(/[$,]/g, '');
        var fundingAmount = parseFloat(amtStr) || null;
        var annRevStr = document.getElementById('annualRevenue').value.replace(/[$,]/g, '');
        var annRevNum = parseFloat(annRevStr) || 0;

        // Map to revenue_range enum
        function getRevenueRange(val) {
            if (val < 500000) return 'Under $500k';
            if (val < 1000000) return '$500k - $1m';
            if (val < 5000000) return '$1m - $5M';
            if (val < 10000000) return '$5M - $10M';
            if (val < 25000000) return '$10M - $25M';
            return 'Over $25m';
        }
        var annualRevRange = annRevNum > 0 ? getRevenueRange(annRevNum) : null;

        // Insert into applications table
        var { data: appData, error: appError } = await db.from('applications').insert([{
            application_id: appId,
            full_name: document.getElementById('ownerName').value,
            email: document.getElementById('bizEmail').value,
            phone: document.getElementById('bizPhone').value,
            business_name: document.getElementById('legalName').value,
            time_in_business: document.getElementById('timeInBusiness').value,
            annual_revenue: annualRevRange,
            funding_amount_requested: fundingAmount,
            funding_amount_text: document.getElementById('advanceAmount').value,
            description: 'Merchant Cash Advance - Purpose: ' + document.getElementById('fundsPurpose').value,
            source_agent_id: sourceAgentId,
            source_channel: referralSlug ? 'Agent' : 'Online',
            referral_slug: referralSlug || null,
            status: 'Application Received',
            submitted_at: now,
            form_type: 'merchant-advance',
            form_data: formData,
            signature_name: sigName,
            signature_timestamp: now
        }]).select();

        if (appError) throw appError;

        // Insert product
        if (appData && appData.length > 0) {
            await db.from('application_products').insert([{
                application_id: appData[0].id,
                product: 'Merchant Advance'
            }]);
        }

        // Upload bank statements to Supabase Storage
        if (selectedBankStatements.length > 0 && appData && appData.length > 0) {
            var appUUID = appData[0].id;
            btn.textContent = 'Uploading documents...';
            document.getElementById('uploadProgress').style.display = 'block';

            for (var fi = 0; fi < selectedBankStatements.length; fi++) {
                var file = selectedBankStatements[fi];
                var filePath = 'applications/' + appUUID + '/' + Date.now() + '-' + file.name.replace(/[^a-zA-Z0-9._-]/g, '_');

                var { data: uploadData, error: uploadError } = await db.storage
                    .from('deal-documents')
                    .upload(filePath, file);

                if (uploadError) {
                    console.error('Upload error for ' + file.name + ':', uploadError);
                    continue; // Don't fail the whole submission for upload errors
                }

                // Create document record
                await db.from('documents').insert([{
                    application_id: appUUID,
                    file_name: file.name,
                    file_path: filePath,
                    file_type: file.type,
                    file_size_bytes: file.size,
                    document_type: 'bank_statement',
                    uploaded_by_name: document.getElementById('ownerName').value || 'Applicant',
                    notes: 'Uploaded with MCA application ' + appId
                }]);

                // Update progress
                var progress = ((fi + 1) / selectedBankStatements.length) * 100;
                document.getElementById('progressBar').style.width = progress + '%';
                document.getElementById('progressText').textContent = 'Uploaded ' + (fi + 1) + ' of ' + selectedBankStatements.length + ' files';
            }
        }

        // Show success
        document.getElementById('formCard').style.display='none';
        document.getElementById('successMsg').style.display='block';
        document.getElementById('appId').textContent=appId;
        document.getElementById('uploadProgress').style.display='none';
        window.scrollTo({top:0,behavior:'smooth'});

    } catch(error) {
        console.error('Submission error:', error);
        alert('There was an error submitting your application. Please try again or contact us at info@alliancefinancing.ai\n\nError: ' + (error.message || 'Unknown error'));
        btn.disabled=false;
        btn.textContent='Submit Merchant Advance Application';
    }
}
</script>
</body>
</html>
