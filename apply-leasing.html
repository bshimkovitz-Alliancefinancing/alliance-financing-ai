<!DOCTYPE html>
<html lang="en">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FHD2GL25L"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date());gtag('config','G-FHD2GL25L');</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Equipment Leasing Application - Alliance Financing AI</title>
    <meta name="description" content="Apply for equipment leasing and financing. $2,500 to $10M+ for machinery, vehicles, technology and more. Serving Canada and the United States.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
nav{position:fixed;top:0;width:100%;background:rgba(255,255,255,.95);backdrop-filter:blur(12px);border-bottom:1px solid #e2e8f0;z-index:1000;padding:1.25rem 0}
.nav-container{max-width:1200px;margin:0 auto;padding:0 2rem;display:grid;grid-template-columns:auto 1fr auto;align-items:center}
.logo{display:flex;align-items:center;text-decoration:none}
.nav-links{display:flex;gap:1.75rem;align-items:center;justify-content:center}
.nav-links a{color:#0F172A;text-decoration:none;font-size:.9375rem;font-weight:600;transition:all .2s;position:relative}
.nav-links a:hover{color:#2563EB}
.nav-links a::after{content:'';position:absolute;bottom:-4px;left:0;width:0;height:2px;background:#2563EB;transition:width .2s}
.nav-links a:hover::after{width:100%}
.nav-cta{justify-self:end;display:flex;gap:1rem}
.btn-outline{background:#fff;color:#334155;border:2px solid #e2e8f0;padding:.75rem 1.5rem;border-radius:.5rem;font-weight:600;cursor:pointer;text-decoration:none;font-size:.9375rem;transition:all .2s}
.btn-outline:hover{border-color:#2563EB;color:#2563EB}
.btn-primary{background:#2563EB;color:#fff;padding:.75rem 1.5rem;border-radius:.5rem;border:none;font-weight:600;cursor:pointer;text-decoration:none;font-size:.9375rem;transition:all .2s}
.btn-primary:hover{background:#1E40AF}
.mobile-menu-btn{display:none;background:#2563EB;border:none;cursor:pointer;padding:.75rem 1.5rem;border-radius:.5rem;color:#fff;font-weight:600;font-size:.9375rem}
@media(max-width:768px){.nav-links,.nav-cta{display:none!important}.mobile-menu-btn{display:block!important}.nav-container{grid-template-columns:auto auto!important}}

*{margin:0;padding:0;box-sizing:border-box}
:root{--primary:#2563EB;--primary-dark:#1E40AF;--slate-50:#F8FAFC;--slate-100:#F1F5F9;--slate-200:#E2E8F0;--slate-600:#475569;--slate-800:#1E293B;--slate-900:#0F172A;--white:#fff;--font:'DM Sans',-apple-system,sans-serif}
body{font-family:var(--font);background:var(--slate-50);color:var(--slate-800);line-height:1.6}

.hero{padding:7rem 2rem 3rem;background:linear-gradient(135deg,#EEF2FF,#F5F3FF);text-align:center}
.hero h1{font-size:clamp(2rem,4vw,2.75rem);font-weight:700;color:var(--slate-900);margin-bottom:.75rem}
.hero p{font-size:1.125rem;color:var(--slate-600);max-width:650px;margin:0 auto}

.form-container{max-width:800px;margin:-2rem auto 4rem;padding:0 1.5rem}
.form-card{background:var(--white);border-radius:1rem;padding:2.5rem;box-shadow:0 4px 20px rgba(0,0,0,.06);border:1px solid var(--slate-200)}
.section-title{font-size:1.25rem;font-weight:700;color:var(--slate-900);margin:2rem 0 1rem;padding-bottom:.5rem;border-bottom:2px solid var(--primary)}
.section-title:first-child{margin-top:0}

.form-row{display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:1rem}
.form-row.three{grid-template-columns:1fr 1fr 1fr}
.form-row.four{grid-template-columns:1fr 1fr 1fr 1fr}
.form-group{display:flex;flex-direction:column}
.form-group.full{grid-column:1/-1}
.form-group label{font-size:.8125rem;font-weight:600;color:var(--slate-600);margin-bottom:.25rem}
.form-group input,.form-group select,.form-group textarea{padding:.625rem .75rem;border:1.5px solid var(--slate-200);border-radius:.5rem;font-size:.9375rem;font-family:var(--font);transition:border .2s;outline:none;width:100%;box-sizing:border-box}
.form-group input:focus,.form-group select:focus,.form-group textarea:focus{border-color:var(--primary);box-shadow:0 0 0 3px rgba(37,99,235,.1)}
.form-group textarea{resize:vertical;min-height:80px}

.checkbox-row{display:flex;gap:1.5rem;align-items:center;margin-bottom:1rem;flex-wrap:wrap}
.checkbox-row label{display:flex;align-items:center;gap:.375rem;font-size:.9375rem;cursor:pointer;font-weight:500}
.checkbox-row input[type="checkbox"],.checkbox-row input[type="radio"]{width:18px;height:18px;accent-color:var(--primary)}

.principal-block{background:var(--slate-50);border:1px solid var(--slate-200);border-radius:.75rem;padding:1.5rem;margin-bottom:1rem}
.principal-block h4{font-size:.9375rem;font-weight:700;color:var(--slate-900);margin-bottom:1rem}

.submit-btn{width:100%;padding:1rem;background:var(--primary);color:#fff;border:none;border-radius:.75rem;font-size:1.0625rem;font-weight:600;cursor:pointer;transition:background .2s;margin-top:1.5rem}
.submit-btn:hover{background:var(--primary-dark)}
.submit-btn:disabled{background:#94A3B8;cursor:not-allowed}

.consent-text{font-size:.75rem;color:var(--slate-600);line-height:1.6;margin-top:1.5rem;padding:1rem;background:var(--slate-50);border-radius:.5rem;border:1px solid var(--slate-200)}

.success-message{display:none;text-align:center;padding:3rem 2rem}
.success-message h2{color:#10B981;font-size:1.75rem;margin-bottom:1rem}
.success-message p{color:var(--slate-600);font-size:1.0625rem;margin-bottom:.5rem}
.doc-instructions{background:#ECFDF5;border:1px solid #BBF7D0;border-radius:.75rem;padding:1.5rem;margin-top:1.5rem;text-align:left}
.doc-instructions h3{color:#166534;font-size:1rem;margin-bottom:.75rem}
.doc-instructions ul{list-style:disc;padding-left:1.25rem;color:#166534;font-size:.9375rem}
.doc-instructions ul li{margin-bottom:.25rem}

.ref-banner{background:linear-gradient(135deg,#2563EB,#7C3AED);color:#fff;text-align:center;padding:.5rem 1rem;font-size:.875rem}
.ref-banner strong{font-weight:700}

.trust-badges{display:flex;justify-content:center;gap:2rem;margin-top:1.5rem;flex-wrap:wrap}
.trust-badge{display:flex;align-items:center;gap:.375rem;font-size:.8125rem;color:var(--slate-600);font-weight:500}
.trust-badge svg{width:16px;height:16px;stroke:#10B981;fill:none}

@media(max-width:768px){
    .form-row,.form-row.three,.form-row.four{grid-template-columns:1fr}
    .form-card{padding:1.5rem}
    .checkbox-row{flex-direction:column;gap:.75rem;align-items:flex-start}
}

footer{background:#0F172A;color:#94A3B8;padding:3rem 0 0}
.footer-container{max-width:1200px;margin:0 auto;padding:0 2rem;display:grid;grid-template-columns:2fr 1fr 1fr 1fr;gap:3rem}
.footer-brand h3{color:#fff;font-size:1.25rem;margin-bottom:.75rem}
.footer-brand p{font-size:.9375rem;line-height:1.7}
.footer-links{display:flex;flex-direction:column;gap:.625rem}
.footer-links h4{color:#fff;font-size:.9375rem;font-weight:600;margin-bottom:.5rem}
.footer-links a{color:#94A3B8;text-decoration:none;font-size:.875rem;transition:color .2s}
.footer-links a:hover{color:#fff}
.footer-bottom{max-width:1200px;margin:2rem auto 0;padding:1.5rem 2rem;border-top:1px solid #1E293B;display:flex;justify-content:space-between;align-items:center;font-size:.875rem}
@media(max-width:768px){.footer-container{grid-template-columns:1fr;gap:2rem}.footer-bottom{flex-direction:column;gap:1rem;text-align:center}}
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

<div id="refBanner" class="ref-banner" style="display:none">
    Referred by: <strong id="refName"></strong>
</div>

<nav>
    <div class="nav-container">
        <a href="index.html" class="logo"><img src="alliance-logo-transparent.png" alt="Alliance Financing Group" style="height:36px;width:auto"></a>
        <div class="nav-links">
            <a href="index.html">Home</a>
            <a href="how-it-works.html">How It Works</a>
            <a href="products.html">Products</a>
            <a href="partners.html">Partners</a>
            <a href="blog.html">Insights</a>
            <a href="track-application.html">Track Application</a>
        </div>
        <div class="nav-cta">
            <a href="contact.html" class="btn-outline">Contact Us</a>
            <a href="application.html" class="btn-primary">Apply Now</a>
        </div>
        <button class="mobile-menu-btn" onclick="window.location.href='application.html'">Apply Now</button>
    </div>
</nav>

<section class="hero">
    <h1>Equipment Leasing Application</h1>
    <p>Finance or lease equipment from $2,500 to $10M+. Complete this application to get matched with the best leasing partners for your needs.</p>
    <div class="trust-badges">
        <span class="trust-badge"><svg viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>256-bit SSL Encrypted</span>
        <span class="trust-badge"><svg viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>No Credit Score Impact</span>
        <span class="trust-badge"><svg viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>100% Free to Apply</span>
    </div>
</section>

<div class="form-container">
    <div class="form-card" id="formCard">

        <div class="section-title">Equipment Information</div>
        <div class="form-row">
            <div class="form-group full">
                <label>Equipment Description *</label>
                <textarea id="equipmentDesc" required placeholder="Describe the equipment you wish to finance"></textarea>
            </div>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label>Equipment Cost ($) *</label>
                <input type="text" id="equipmentCost" required placeholder="e.g. $50,000">
            </div>
            <div class="form-group">
                <label>Vendor / Supplier Name</label>
                <input type="text" id="vendorName" placeholder="Equipment seller/dealer">
            </div>
        </div>
        <div class="checkbox-row">
            <label><strong style="margin-right:.5rem">Condition:</strong></label>
            <label><input type="radio" name="condition" value="New" checked> New</label>
            <label><input type="radio" name="condition" value="Used"> Used</label>
        </div>

        <div class="section-title">Company Information</div>
        <div class="form-row">
            <div class="form-group">
                <label>Business Legal Name *</label>
                <input type="text" id="legalName" required>
            </div>
            <div class="form-group">
                <label>Operating As (Trade Name)</label>
                <input type="text" id="tradeName">
            </div>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label>Phone *</label>
                <input type="tel" id="bizPhone" required>
            </div>
            <div class="form-group">
                <label>Email *</label>
                <input type="email" id="bizEmail" required>
            </div>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label>GST or Federal ID Number *</label>
                <input type="text" id="gstFedId" required placeholder="e.g. 123456789 RT0001">
            </div>
        </div>
        <div class="form-group full" style="margin-bottom:1rem">
            <label>Address *</label>
            <input type="text" id="bizAddress" required>
        </div>
        <div class="form-row four">
            <div class="form-group">
                <label>City *</label>
                <input type="text" id="bizCity" required>
            </div>
            <div class="form-group">
                <label>Province/State *</label>
                <input type="text" id="bizProv" required>
            </div>
            <div class="form-group">
                <label>Postal/Zip *</label>
                <input type="text" id="bizPostal" required>
            </div>
            <div class="form-group">
                <label>Country *</label>
                <select id="bizCountry" required>
                    <option value="Canada">Canada</option>
                    <option value="United States">United States</option>
                </select>
            </div>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label>Contact Name *</label>
                <input type="text" id="contactName" required>
            </div>
            <div class="form-group">
                <label>Contact Title</label>
                <input type="text" id="contactTitle">
            </div>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label>Description of Business *</label>
                <input type="text" id="bizDescription" required placeholder="Industry / what the business does">
            </div>
            <div class="form-group">
                <label>Business Start Date *</label>
                <input type="text" id="bizStartDate" required placeholder="MM/YYYY">
            </div>
        </div>
        <div class="checkbox-row">
            <label><strong style="margin-right:.5rem">Structure:</strong></label>
            <label><input type="radio" name="structure" value="Incorporated" checked> Incorporated</label>
            <label><input type="radio" name="structure" value="Partnership"> Partnership</label>
            <label><input type="radio" name="structure" value="Proprietorship"> Proprietorship</label>
            <label><input type="radio" name="structure" value="Other"> Other</label>
        </div>

        <div class="section-title">Equipment Location</div>
        <div class="checkbox-row">
            <label><input type="checkbox" id="sameAsAbove" checked onchange="toggleEquipLocation()"> Same as business address above</label>
        </div>
        <div id="equipLocationFields" style="display:none">
            <div class="form-group full" style="margin-bottom:1rem">
                <label>Equipment Address</label>
                <input type="text" id="equipAddress">
            </div>
            <div class="form-row three">
                <div class="form-group"><label>City</label><input type="text" id="equipCity"></div>
                <div class="form-group"><label>Province/State</label><input type="text" id="equipProv"></div>
                <div class="form-group"><label>Postal/Zip</label><input type="text" id="equipPostal"></div>
            </div>
        </div>

        <div class="section-title">Insurance & Landlord</div>
        <div class="form-row three">
            <div class="form-group"><label>Insurance Broker</label><input type="text" id="insurBroker"></div>
            <div class="form-group"><label>Broker Contact</label><input type="text" id="insurContact"></div>
            <div class="form-group"><label>Broker Phone</label><input type="tel" id="insurPhone"></div>
        </div>
        <div class="form-row three">
            <div class="form-group"><label>Landlord Name</label><input type="text" id="landlord"></div>
            <div class="form-group"><label>Landlord Contact</label><input type="text" id="landlordContact"></div>
            <div class="form-group"><label>Landlord Phone</label><input type="tel" id="landlordPhone"></div>
        </div>

        <div class="section-title">Principal #1 (Owner/Guarantor) *</div>
        <div class="principal-block">
            <div class="form-row">
                <div class="form-group"><label>Full Legal Name *</label><input type="text" id="p1Name" required></div>
                <div class="form-group"><label>Title *</label><input type="text" id="p1Title" required></div>
            </div>
            <div class="form-row three">
                <div class="form-group"><label>% Ownership *</label><input type="text" id="p1Ownership" required placeholder="e.g. 50%"></div>
                <div class="form-group"><label>Date of Birth *</label><input type="date" id="p1DOB" required></div>
                <div class="form-group"><label>Phone</label><input type="tel" id="p1Phone"></div>
            </div>
            <div class="form-group full" style="margin-bottom:1rem">
                <label>Home Address *</label>
                <input type="text" id="p1Address" required>
            </div>
            <div class="form-row three">
                <div class="form-group"><label>City *</label><input type="text" id="p1City" required></div>
                <div class="form-group"><label>Province/State *</label><input type="text" id="p1Prov" required></div>
                <div class="form-group"><label>Postal/Zip *</label><input type="text" id="p1Postal" required></div>
            </div>
        </div>

        <div class="section-title">Principal #2 (if applicable)</div>
        <div class="principal-block">
            <div class="form-row">
                <div class="form-group"><label>Full Legal Name</label><input type="text" id="p2Name"></div>
                <div class="form-group"><label>Title</label><input type="text" id="p2Title"></div>
            </div>
            <div class="form-row three">
                <div class="form-group"><label>% Ownership</label><input type="text" id="p2Ownership"></div>
                <div class="form-group"><label>Date of Birth</label><input type="date" id="p2DOB"></div>
                <div class="form-group"><label>Phone</label><input type="tel" id="p2Phone"></div>
            </div>
            <div class="form-group full" style="margin-bottom:1rem">
                <label>Home Address</label>
                <input type="text" id="p2Address">
            </div>
            <div class="form-row three">
                <div class="form-group"><label>City</label><input type="text" id="p2City"></div>
                <div class="form-group"><label>Province/State</label><input type="text" id="p2Prov"></div>
                <div class="form-group"><label>Postal/Zip</label><input type="text" id="p2Postal"></div>
            </div>
        </div>

        <div class="section-title">E-Signature & Authorization</div>
        <div class="form-group full" style="margin-bottom:1rem">
            <label>Print Your Full Legal Name (Electronic Signature) *</label>
            <input type="text" id="signatureName" required placeholder="Your full legal name as it appears on official ID" style="font-size:1.1rem;font-weight:600;border:2px solid var(--primary);padding:.75rem">
        </div>
        <div style="background:#EFF6FF;border:1px solid #BFDBFE;border-radius:.75rem;padding:1.25rem;margin-bottom:1rem">
            <p style="color:#1E40AF;font-size:.875rem;line-height:1.6;margin-bottom:.5rem">
                By typing your name above and submitting this application, you are electronically signing this document.
                This electronic signature is legally binding and has the same effect as a handwritten signature under the
                <em>Personal Information Protection and Electronic Documents Act</em> (PIPEDA) and applicable provincial and state laws.
            </p>
            <p style="color:#1E40AF;font-size:.8125rem">
                Signature date &amp; time: <strong id="sigTimestamp">Will be recorded on submission</strong>
            </p>
        </div>

        <div class="consent-text">
            <label><input type="checkbox" id="consentCheck" required style="margin-right:.5rem">
            I confirm that the information provided is true and complete. I authorize Alliance Financing Group Ltd. and its affiliates to obtain credit reports and credit information from any credit reporting agency, and to hold, use, exchange and disclose such information for the purposes of evaluating this application. If approved, I authorize the collection and use of personal information to administer the financing contract and secure the assets being financed, as required or permitted by law.</label>
        </div>

        <input type="hidden" id="referralSource" value="">
        <input type="hidden" id="formType" value="leasing">

        <button type="button" class="submit-btn" id="submitBtn" onclick="submitLeaseApp()">Submit Leasing Application</button>
    </div>

    <!-- Success Message -->
    <div class="form-card success-message" id="successMsg">
        <svg width="64" height="64" fill="none" stroke="#10B981" viewBox="0 0 24 24" style="margin:0 auto 1rem;display:block"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
        <h2>Application Submitted!</h2>
        <p>Your application ID is: <strong id="appId"></strong></p>
        <p>Our team will review your application and contact you within 48 hours.</p>
        <div class="doc-instructions">
            <h3>ðŸ“Ž Supporting Documents Required</h3>
            <p style="margin-bottom:.5rem;color:#166534">Please email the following documents to <strong>info@alliancefinancing.ai</strong> with your Application ID in the subject line:</p>
            <ul>
                <li>Equipment quote or invoice from vendor</li>
                <li>Most recent 2 years of business financial statements</li>
                <li>Most recent 3 months of business bank statements</li>
                <li>Government-issued ID for all principals/guarantors</li>
                <li>Void business cheque</li>
            </ul>
        </div>
    </div>
</div>

<footer>
    <div class="footer-container">
        <div class="footer-brand">
            <h3>Alliance Financing Group Ltd.</h3>
            <p>35 years of commercial financing expertise meets AI-powered technology.</p>
            <p style="margin-top:1rem"><strong>Phone:</strong> <a href="tel:+18006603660" style="color:inherit;text-decoration:none">1-800-660-3660 ext. 222</a><br><strong>Email:</strong> <a href="mailto:info@alliancefinancing.ai" style="color:inherit;text-decoration:none">info@alliancefinancing.ai</a></p>
        </div>
        <div class="footer-links"><h4>Products</h4><a href="working-capital.html">Working Capital</a><a href="equipment-financing.html">Equipment Financing</a><a href="lines-of-credit.html">Lines of Credit</a><a href="invoice-factoring.html">Invoice Factoring</a><a href="commercial-real-estate.html">Commercial Real Estate</a></div>
        <div class="footer-links"><h4>Company</h4><a href="about.html">About Us</a><a href="how-it-works.html">How It Works</a><a href="partners.html">Partners</a><a href="blog.html">Insights</a></div>
        <div class="footer-links"><h4>Legal</h4><a href="privacy-policy.html">Privacy Policy</a><a href="terms-of-service.html">Terms of Service</a><a href="faq.html">FAQ</a><a href="contact.html">Contact Us</a></div>
    </div>
    <div class="footer-bottom"><p>&copy; 2026 Alliance Financing Group Ltd. All rights reserved.</p></div>
</footer>

<script>
const SUPABASE_URL = 'https://uernphejrcsicnkobsdw.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVlcm5waGVqcmNzaWNua29ic2R3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA5MzU3ODksImV4cCI6MjA4NjUxMTc4OX0.A2YN3gkaYwR_9nyE3OkWl5Io9tfxe8lTgC913stXmUI';
const db = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

function toggleEquipLocation(){
    var f=document.getElementById('equipLocationFields');
    f.style.display=document.getElementById('sameAsAbove').checked?'none':'block';
}

// Capture referral from URL
(function(){
    var params=new URLSearchParams(window.location.search);
    var ref=params.get('ref')||params.get('referral')||'';
    if(ref){
        document.getElementById('referralSource').value=ref;
        document.getElementById('refBanner').style.display='block';
        document.getElementById('refName').textContent=ref.replace(/-/g,' ').replace(/\b\w/g,function(l){return l.toUpperCase()});
    }
})();

// Update signature timestamp as user types
document.getElementById('signatureName').addEventListener('input', function() {
    if (this.value.trim()) {
        document.getElementById('sigTimestamp').textContent = new Date().toLocaleString('en-US', {
            year: 'numeric', month: 'long', day: 'numeric',
            hour: '2-digit', minute: '2-digit', second: '2-digit', timeZoneName: 'short'
        });
    } else {
        document.getElementById('sigTimestamp').textContent = 'Will be recorded on submission';
    }
});

async function submitLeaseApp(){
    var btn=document.getElementById('submitBtn');

    // Validate e-signature
    var sigName = document.getElementById('signatureName').value.trim();
    if(!sigName){
        document.getElementById('signatureName').focus();
        document.getElementById('signatureName').style.borderColor='#EF4444';
        alert('Please enter your full legal name for the electronic signature.');
        return;
    }

    if(!document.getElementById('consentCheck').checked){alert('Please accept the consent and authorization to proceed.');return;}

    // Validate required fields
    var required=['equipmentDesc','equipmentCost','legalName','bizPhone','bizEmail','gstFedId','bizAddress','bizCity','bizProv','bizPostal','contactName','bizDescription','bizStartDate','p1Name','p1Title','p1Ownership','p1DOB','p1Address','p1City','p1Prov','p1Postal'];
    for(var i=0;i<required.length;i++){
        var el=document.getElementById(required[i]);
        if(!el.value.trim()){el.focus();el.style.borderColor='#EF4444';alert('Please fill in all required fields.');return;}
    }

    btn.disabled=true;btn.textContent='Submitting...';

    var appId='ALF-L-'+Date.now().toString(36).toUpperCase();
    var now = new Date().toISOString();

    // Collect ALL form data for JSONB storage
    var formData={
        formType:'leasing',
        applicationId:appId,
        submittedAt:now,
        referralSource:document.getElementById('referralSource').value,
        equipmentDescription:document.getElementById('equipmentDesc').value,
        equipmentCost:document.getElementById('equipmentCost').value,
        vendorName:document.getElementById('vendorName').value,
        equipmentCondition:document.querySelector('input[name="condition"]:checked').value,
        businessLegalName:document.getElementById('legalName').value,
        tradeName:document.getElementById('tradeName').value,
        businessPhone:document.getElementById('bizPhone').value,
        businessEmail:document.getElementById('bizEmail').value,
        gstFedId:document.getElementById('gstFedId').value,
        businessAddress:document.getElementById('bizAddress').value,
        city:document.getElementById('bizCity').value,
        province:document.getElementById('bizProv').value,
        postalCode:document.getElementById('bizPostal').value,
        country:document.getElementById('bizCountry').value,
        contactName:document.getElementById('contactName').value,
        contactTitle:document.getElementById('contactTitle').value,
        businessDescription:document.getElementById('bizDescription').value,
        businessStartDate:document.getElementById('bizStartDate').value,
        structure:document.querySelector('input[name="structure"]:checked').value,
        equipSameAsAbove:document.getElementById('sameAsAbove').checked?'Yes':'No',
        equipAddress:document.getElementById('equipAddress').value,
        equipCity:document.getElementById('equipCity').value,
        equipProv:document.getElementById('equipProv').value,
        equipPostal:document.getElementById('equipPostal').value,
        insuranceBroker:document.getElementById('insurBroker').value,
        insuranceContact:document.getElementById('insurContact').value,
        insurancePhone:document.getElementById('insurPhone').value,
        landlord:document.getElementById('landlord').value,
        landlordContact:document.getElementById('landlordContact').value,
        landlordPhone:document.getElementById('landlordPhone').value,
        principal1Name:document.getElementById('p1Name').value,
        principal1Title:document.getElementById('p1Title').value,
        principal1Ownership:document.getElementById('p1Ownership').value,
        principal1DOB:document.getElementById('p1DOB').value,
        principal1Phone:document.getElementById('p1Phone').value,
        principal1Address:document.getElementById('p1Address').value,
        principal1City:document.getElementById('p1City').value,
        principal1Prov:document.getElementById('p1Prov').value,
        principal1Postal:document.getElementById('p1Postal').value,
        principal2Name:document.getElementById('p2Name').value,
        principal2Title:document.getElementById('p2Title').value,
        principal2Ownership:document.getElementById('p2Ownership').value,
        principal2DOB:document.getElementById('p2DOB').value,
        principal2Phone:document.getElementById('p2Phone').value,
        principal2Address:document.getElementById('p2Address').value,
        principal2City:document.getElementById('p2City').value,
        principal2Prov:document.getElementById('p2Prov').value,
        principal2Postal:document.getElementById('p2Postal').value,
        signatureName: sigName,
        signatureTimestamp: now
    };

    try {
        // Look up agent ID from referral slug
        var referralSlug = document.getElementById('referralSource').value;
        var sourceAgentId = null;
        if (referralSlug) {
            var { data: agentData } = await db.from('users').select('id').eq('referral_slug', referralSlug).maybeSingle();
            if (agentData) sourceAgentId = agentData.id;
        }

        // Parse funding amount (remove $ and commas)
        var costStr = document.getElementById('equipmentCost').value.replace(/[$,]/g, '');
        var fundingAmount = parseFloat(costStr) || null;

        // Insert into applications table
        var { data: appData, error: appError } = await db.from('applications').insert([{
            application_id: appId,
            full_name: document.getElementById('contactName').value,
            email: document.getElementById('bizEmail').value,
            phone: document.getElementById('bizPhone').value,
            business_name: document.getElementById('legalName').value,
            time_in_business: document.getElementById('bizStartDate').value,
            funding_amount_requested: fundingAmount,
            funding_amount_text: document.getElementById('equipmentCost').value,
            description: 'Equipment Leasing: ' + document.getElementById('equipmentDesc').value.substring(0, 200),
            source_agent_id: sourceAgentId,
            source_channel: referralSlug ? 'Agent' : 'Online',
            referral_slug: referralSlug || null,
            status: 'Application Received',
            submitted_at: now,
            form_type: 'leasing',
            form_data: formData,
            signature_name: sigName,
            signature_timestamp: now
        }]).select();

        if (appError) throw appError;

        // Insert product into application_products junction table
        if (appData && appData.length > 0) {
            await db.from('application_products').insert([{
                application_id: appData[0].id,
                product: 'Equipment Leasing'
            }]);
        }

        // Show success
        document.getElementById('formCard').style.display='none';
        document.getElementById('successMsg').style.display='block';
        document.getElementById('appId').textContent=appId;
        window.scrollTo({top:0,behavior:'smooth'});

    } catch(error) {
        console.error('Submission error:', error);
        alert('There was an error submitting your application. Please try again or contact us at info@alliancefinancing.ai\n\nError: ' + (error.message || 'Unknown error'));
        btn.disabled=false;
        btn.textContent='Submit Leasing Application';
    }
}
</script>

</body>
</html>
